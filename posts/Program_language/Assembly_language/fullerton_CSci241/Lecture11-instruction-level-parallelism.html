<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html"><meta property="og:site_name" content="Code Building"><meta property="og:title" content="第十一讲：指令级并行, SIMD 和流水线"><meta property="og:description" content="第十一讲：指令级并行, SIMD 和流水线 如果 xmm 寄存器是 128 位宽，但浮点值是 32 或 64 位宽，那么剩下的位是什么？答案是，更多的浮点值！每个 xmm 寄存器都可以被视为打包到单个寄存器中的 4 个单精度或 2 个双精度浮点值的数组。 所有上述操作仅对寄存器中的“低”值进行操作（以数组表示法，xmm[0]）.他们通常只是复制其余元素不变。 addps xmm0, xmm1 ; 等同于: ; xmm0[0] += xmm1[0] ; xmm0[1] += xmm1[1] ; xmm0[2] += xmm1[2] ; xmm0[3] += xmm1[3] ; 但是是同时运行的"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-15T10:00:05.000Z"><meta property="article:modified_time" content="2024-03-15T10:00:05.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"第十一讲：指令级并行, SIMD 和流水线","image":[""],"dateModified":"2024-03-15T10:00:05.000Z","author":[]}</script><title>第十一讲：指令级并行, SIMD 和流水线 | Code Building</title><meta name="description" content="第十一讲：指令级并行, SIMD 和流水线 如果 xmm 寄存器是 128 位宽，但浮点值是 32 或 64 位宽，那么剩下的位是什么？答案是，更多的浮点值！每个 xmm 寄存器都可以被视为打包到单个寄存器中的 4 个单精度或 2 个双精度浮点值的数组。 所有上述操作仅对寄存器中的“低”值进行操作（以数组表示法，xmm[0]）.他们通常只是复制其余元素不变。 addps xmm0, xmm1 ; 等同于: ; xmm0[0] += xmm1[0] ; xmm0[1] += xmm1[1] ; xmm0[2] += xmm1[2] ; xmm0[3] += xmm1[3] ; 但是是同时运行的">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-646e803e.css" as="style"><link rel="stylesheet" href="/assets/style-646e803e.css">
    <link rel="modulepreload" href="/assets/app-d7ca8ce0.js"><link rel="modulepreload" href="/assets/framework-9a29aaa0.js"><link rel="modulepreload" href="/assets/Lecture11-instruction-level-parallelism.html-3fb20bb8.js"><link rel="modulepreload" href="/assets/Lecture11-instruction-level-parallelism.html-c831723a.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Code Building"><!----><span class="site-name hide-in-pad">Code Building</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="程序员小x"><span class="font-icon icon iconfont icon-home" style=""></span>程序员小x<!----></a></div><div class="nav-item hide-in-mobile"><a href="/demo/" class="nav-link" aria-label="演示"><span class="font-icon icon iconfont icon-discover" style=""></span>演示<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博文"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>博文</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/network" class="nav-link" aria-label="计算机网络"><span class="font-icon icon iconfont icon-edit" style=""></span>计算机网络<!----></a></li><li class="dropdown-item"><a href="/posts/Program_language/cpp" class="nav-link" aria-label="c++"><span class="font-icon icon iconfont icon-edit" style=""></span>c++<!----></a></li><li class="dropdown-item"><a href="/posts/design-pattern" class="nav-link" aria-label="设计模式"><span class="font-icon icon iconfont icon-edit" style=""></span>设计模式<!----></a></li><li class="dropdown-item"><a href="/posts/tool" class="nav-link" aria-label="工具"><span class="font-icon icon iconfont icon-edit" style=""></span>工具<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/compile" class="nav-link" aria-label="编译原理"><span class="font-icon icon iconfont icon-edit" style=""></span>编译原理<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/kernel/Linux-0.11" class="nav-link" aria-label="Linux-0.11详解"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux-0.11详解<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/application-dev" class="nav-link" aria-label="Linux应用层开发"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux应用层开发<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://meiriyiwen.com/" rel="noopener noreferrer" target="_blank" aria-label="每日一文" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>每日一文<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/posts/about/about.html" class="nav-link" aria-label="关于作者"><span class="font-icon icon iconfont icon-about" style=""></span>关于作者<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->第十一讲：指令级并行, SIMD 和流水线</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://zgjsxx.github.io" target="_blank" rel="noopener noreferrer">程序员小x</a></span><span property="author" content="程序员小x"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-02-29T09:11:13.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 11 分钟</span><meta property="timeRequired" content="PT11M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category5 clickable" role="navigation">汇编语言</span><meta property="articleSection" content="汇编语言"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#压缩算术运算" class="router-link-active router-link-exact-active toc-link level2">压缩算术运算</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#移动打包数据" class="router-link-active router-link-exact-active toc-link level3">移动打包数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#在寄存器内移动" class="router-link-active router-link-exact-active toc-link level3">在寄存器内移动</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#压缩算术" class="router-link-active router-link-exact-active toc-link level3">压缩算术</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#打包转换" class="router-link-active router-link-exact-active toc-link level3">打包转换</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#打包比较" class="router-link-active router-link-exact-active toc-link level3">打包比较</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#打包等价于浮点操作" class="router-link-active router-link-exact-active toc-link level3">打包等价于浮点操作</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#指令级并行" class="router-link-active router-link-exact-active toc-link level2">指令级并行</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#经典的-mips-流水线" class="router-link-active router-link-exact-active toc-link level3">经典的 MIPS 流水线</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.html#指令执行阶段" class="router-link-active router-link-exact-active toc-link level3">指令执行阶段</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="第十一讲-指令级并行-simd-和流水线" tabindex="-1"><a class="header-anchor" href="#第十一讲-指令级并行-simd-和流水线" aria-hidden="true">#</a> 第十一讲：指令级并行, SIMD 和流水线</h1><p>如果 <code>xmm</code> 寄存器是 128 位宽，但浮点值是 32 或 64 位宽，那么剩下的位是什么？答案是，更多的浮点值！每个 <code>xmm</code> 寄存器都可以被视为打包到单个寄存器中的 4 个单精度或 2 个双精度浮点值的数组。 所有上述操作仅对寄存器中的“低”值进行操作（以数组表示法，<code>xmm[0]</code>）.他们通常只是复制其余元素不变。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>addps xmm0, xmm1
; 等同于:
;   xmm0[0] += xmm1[0]
;   xmm0[1] += xmm1[1]
;   xmm0[2] += xmm1[2]
;   xmm0[3] += xmm1[3]
; 但是是同时运行的
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这与只执行一次加法的普通 <code>addss</code> 指令占用相同的 CPU 时间。 （第一个 s 代表“标量”，而 p 代表“打包”。）</p><p>这种并行性称为<strong>单指令-多数据</strong> (<strong>S</strong>ingle-<strong>I</strong>nstruction, <strong>M</strong>ultiple-<strong>D</strong>ata), 简称SIMD。我们发出一条指令，但它并行应用于多个操作数。</p><p>需要记住的一件事是，因为这些操作与正常的“解包”浮点操作花费相同的时间，所以即使我们只有一个浮点值要操作，我们也可以使用它们， 只是忽略所有其他结果。有些“打包”操作没有解包的单元素等价物，但即使在非并行代码中，您也应该随意使用它们。</p><p>另一件需要注意的事情是，许多压缩操作需要整数操作数，或者直接对其操作数的位进行操作。一般来说，这些指令对浮点操作数没有意义，除了一种情况：操作符号位。在单精度和双精度浮点值中，符号位始终是最高位。因此，我们可以使用打包的按位 AND/OR/XOR 运算来操作浮点数的符号，而无需求助于乘以 -1 之类的技巧:</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>; This sets up xmm1 so that only the high bit is set
cmpeqd xmm1, xmm1   ; xmm1 == xmm1? True, sets all bits to 1
pslld  xmm1, 31

xorps xmm0, xmm1 ; xmm0 = -xmm0
orps  xmm0, xmm1 ; xmm0 = -abs(xmm0)
pandn xmm0, xmm1 ; xmm0 = abs(xmm0)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>cmpeqd</code> 比较源和目标中的双字元素是否相等；如果比较为真，则每个元素设置为全 1；如果比较为假，则设置为全 0。因此，这将 xmm1 设置为全 1。</li><li><code>pslld</code> 对每个元素执行左移。将每个元素向左移动 31 位，实际上会移动 31 个 0，在最高位位置（符号位的位置）留下 1。</li><li><code>xorps</code> 对每对元素的位执行异或运算。由于 xmm1 中仅设置了符号位，因此这实际上翻转了 xmm0 的符号位。</li><li>orps 对每对元素的位执行 OR 运算，将 xmm0 的符号位设置为 1。</li><li>pandn 对这些位执行 AND-NOT 运算，首先对 xmm1 取反（这样除了符号位为 0 之外，它都是 1），然后与 xmm0 进行 AND 运算，清除符号位，同时保持其他位不变。</li></ul><p>这种东西也可以用来直接在寄存器中“生成”浮点常量，而不是从内存中加载它。</p><h2 id="压缩算术运算" tabindex="-1"><a class="header-anchor" href="#压缩算术运算" aria-hidden="true">#</a> 压缩算术运算</h2><p>最容易理解的压缩 (SIMD) 运算是算术运算；这些进行算术运算（+、-、*、/）并应用</p><p><strong>&quot;垂直&quot;与&quot;水平&quot;操作</strong></p><p>我们可以将打包操作视为“垂直”：我们有很多值，并且我们希望对它们应用相同的操作</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>xmm0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    xmm0<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    xmm0<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>    xmm0<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
   +          +          +          +   
   <span class="token operator">=</span>          <span class="token operator">=</span>          <span class="token operator">=</span>          <span class="token operator">=</span>
xmm1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    xmm1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    xmm1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>    xmm1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这与对序列元素求和等操作不同，我们可以将其视为“水平”：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>a + b + c + d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在垂直运算中，没有任何加法依赖于任何其他加法，因此我们可以在一次加法的时间内同时完成所有这些操作。在水平操作中，无论我们如何分解，某些加法都必须等待另一个加法的结果。我们能做的最好的就是</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>a + b<span class="token punctuation">)</span> + <span class="token punctuation">(</span>c + d<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>但即使我们可以与 <code>c + d</code> 同时执行 <code>a + b</code>，外部加法也必须等到这两个操作都完成。横向操作有数据依赖。操作的一部分必须等待另一部分。</p><p>复杂性理论家已经计算出了如果允许无限量的并行性，我们可以预期的加速程度。例如，如果我们有一个可以同时执行无限次加法的 CPU，那么我们可以在恒定时间内执行任意大小的垂直加法，O(1)。但水平添加由于其数据依赖性，仍然会需要一些等待。事实上，即使具有无限并行性，水平、数据相关的操作最多也可以以对数、O(logn) 的方式完成。无论我们有多少并行性，我们永远无法将它们降低到 O(1)。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>haddps dest, src        ; add dest[0] = src[0]+src[1], dest[1] = src[2]+src[3]
haddpd dest, src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>请注意，为了对所有四个元素求和，我们需要执行两个 haddps 指令。 hadd 和 hsub 是唯一支持的两个水平操作；所有其他打包操作都是垂直的。</p><h3 id="移动打包数据" tabindex="-1"><a class="header-anchor" href="#移动打包数据" aria-hidden="true">#</a> 移动打包数据</h3><p>我们用于浮点的 <code>movss</code>/<code>movsd</code> 指令也可用于打包数据, 源数据的低位元素被复制到目标，而目标的其余元素保持不变。<code>movss</code>仅仅复制低32bit数据，<code>movsd</code>复制低64bit数据。</p><p>最简单的打包 mov 指令是 <code>movups</code>/<code>movupd</code>。这会将 128 位数据从内存移动到 xmm 寄存器，从 xmm 寄存器移动到内存，或者从一个 xmm 寄存器移动到另一个 xmm 寄存器。数据被解释为四个单精度浮点数或两个双精度浮点数。<code>u</code> 代表未对齐；当移入或移出内存时，这些指令不要求目标与 16 字节的倍数对齐。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>movups dest, src
movupd dest, src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果您知道内存数据与 16 字节的倍数对齐，则对齐移动会更快：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>movaps dest, src
movapd dest, src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果您尝试在未对齐的地址上使用对齐的 <code>movap</code>，您的程序将会崩溃。</p><p>如果需要将单个值加载到 xmm 寄存器的所有元素中，可以使用 vbroadcast：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>vbroadcastss dest, mem ; load dword from [mem] into all elements of dest
vbroadcastsd dest, mem ; load qword from [mem] into both elements of dest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="在寄存器内移动" tabindex="-1"><a class="header-anchor" href="#在寄存器内移动" aria-hidden="true">#</a> 在寄存器内移动</h3><p>有许多指令可用于移动寄存器内的打包值。例如，movsldup 指令将源寄存器的偶数元素复制到目标寄存器的偶数和奇数元素中，并复制它们。那是，</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>movsldup xmm0, xmm1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>等价于：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>xmm0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> xmm0<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> xmm1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
xmm0<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> xmm0<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> xmm1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>movshdup 执行相同的操作，但使用源的奇数元素。</p><h3 id="压缩算术" tabindex="-1"><a class="header-anchor" href="#压缩算术" aria-hidden="true">#</a> 压缩算术</h3><p>所有正常的浮点运算都有压缩变体：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>addps dest, src
addpd dest, src
subps dest, src
subpd dest, src
mulps dest, src
mulpd dest, src
divps dest, src
divpd dest, src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="打包转换" tabindex="-1"><a class="header-anchor" href="#打包转换" aria-hidden="true">#</a> 打包转换</h3><p>所有 cvt 指令都包含等效指令。当与整数进行转换时，它们不是转换为通用寄存器，而是转换为 xmm 寄存器</p><h3 id="打包比较" tabindex="-1"><a class="header-anchor" href="#打包比较" aria-hidden="true">#</a> 打包比较</h3><p>打包比较的工作方式与普通比较完全不同。因为相同的操作必须应用于 xmm 寄存器的所有元素，所以将比较结果写入标志寄存器（哪个结果？）是没有用的，即使有，我们将如何使用这些结果，因为（取决于比较）我们可能需要对寄存器的不同元素执行不同的操作？</p><p>打包比较将布尔（0 或 1）结果生成到另一个 xmm 寄存器中。然后，这些结果可以用作掩码，以避免操作特定元素，或相乘，将某些元素归零等。这扩展了条件移动范例，其中我们有一系列始终执行的指令，但部分指令有条件地激活/停用，取决于数据值。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>cmpeqps  dest, src           ; ==
cmpltps  dest, src           ; &lt;
cmpleps  dest, src           ; &lt;=
cmpneps  dest, src           ; != 
cmpnltps dest, src           ; &gt;=
cmpnleps dest, src           ; &gt;
cmpordps dest, src           ; True if neither operand is NaN
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果比较结果为真，则将dest对应的元素设置为全1，否则设置为全0。</p><p>（所有这些实际上只是 cmpss 指令的别名，其第三个操作数具有不同的值。）</p><h3 id="打包等价于浮点操作" tabindex="-1"><a class="header-anchor" href="#打包等价于浮点操作" aria-hidden="true">#</a> 打包等价于浮点操作</h3><table><thead><tr><th>操作</th><th>描述</th></tr></thead><tbody><tr><td><code>maxps dest, src</code></td><td><code>dest = max(dest, src)</code></td></tr><tr><td><code>minps dest, src</code></td><td><code> dest = min(dest, src)</code></td></tr><tr><td><code>sqrtps dest, src</code></td><td><code>dest = sqrt(src)</code></td></tr><tr><td><code>rcpps dest, src</code></td><td><code>dest = 1/src</code></td></tr><tr><td><code>rsqrtps dest, src</code></td><td><code>dest = 1 / sqrt(src)</code></td></tr><tr><td><code>roundps dest, src, mode</code></td><td></td></tr><tr><td><code>dpps</code></td><td></td></tr></tbody></table><h2 id="指令级并行" tabindex="-1"><a class="header-anchor" href="#指令级并行" aria-hidden="true">#</a> 指令级并行</h2><p>上面讲解的向量运算是指令级并行(ILP)的一个例子，一条指令就可以使CPU同时执行多个操作。向量指令是一种显式的指令并行化的例子， 除此以外，现代 CPU 架构还有一种隐式ILP，其自行计算出何时可以重叠多个指令并执行此操作。</p><p>这种指令重叠是通过使用指令流水线来完成的。不过这种流水线的结构并不是 x86 CPU 公共规范的一部分。为了研究指令流水线，我们切换到另一种CPU架构MIPS。MIPS 是精简指令集架构的一个例子，它没有许多复杂但有用的指令，而是一些简单但快速的指令。指令集的这种简单性使得流水线行为成为 CPU 规范的一部分，程序员和编译器编写者可以依赖它以特定方式运行。</p><h3 id="经典的-mips-流水线" tabindex="-1"><a class="header-anchor" href="#经典的-mips-流水线" aria-hidden="true">#</a> 经典的 MIPS 流水线</h3><p>在x86指令集中，任何指令都可以访问内存，唯一的限制是单个指令不能同时读写内存（两个操作数不能同时是内存）。这使得 x86 CPU 的设计变得复杂，因为执行任何指令的过程可能需要使用处理内存的 CPU 组件。更糟糕的是，指令中发生这种情况的阶段各不相同：有时需要在指令的开头（从内存读取时）发生，有时需要在指令的末尾（写入内存时）发生。</p><p>MIPS 通过施加严格的限制来简化这一点：只有两条指令访问内存，所有其他指令仅对寄存器进行操作。 （MIPS 有 32 个寄存器来弥补这一点。）访问内存的两条指令是</p><ul><li><p><code>LOD reg, mem</code>：从地址 mem 加载到寄存器 reg 中。 mem 可以是直接内存地址，也可以是寄存器间接地址，由寄存器偏移量 + 常量基地址组成。</p></li><li><p><code>STO mem, reg</code>：将寄存器reg中的值存储到内存地址mem中。 mem 可以是包含地址的寄存器。</p></li><li></li></ul><p>请注意，内存地址可以是立即数（常量）或寄存器，但不能是 x86 上允许的计算。因此，这两条指令比我们习惯的 mov 指令要简单得多。</p><p>所有其他指令仅在寄存器上运行：</p><ul><li><p>ADD r1, r2, r3, SUB r1, r2 r3：计算 r1 = r2 + r3 或 r1 = r2 - r3。乘法和除法以及所有浮点运算的特殊之处在于它们是多周期运算。</p></li><li><p>位运算 AND、OR、移位等</p></li><li><p>条件和无条件分支：J（无条件跳转）、BLTZ（有条件跳转，小于0）等。支持跳转到寄存器地址。</p></li></ul><h3 id="指令执行阶段" tabindex="-1"><a class="header-anchor" href="#指令执行阶段" aria-hidden="true">#</a> 指令执行阶段</h3><p>每条指令的执行分为五个阶段；并非每条指令都需要全部五个（即，有时某些阶段被“关闭”），但没有阶段是每个阶段都重复或乱序执行的。阶段是</p><ul><li><p>取指令（IF）。该指令以字节形式从内存或指令高速缓存中读入。与 x86 不同，MIPS 指令始终为 4 字节大。 （x86 指令的长度可以是 1 到 15 个字节，具体取决于指令及其前缀。）指令保存在 CPU 上的一个特殊寄存器中。此阶段还会递增程序计数器，MIPS 相当于指令指针寄存器。</p></li><li><p>指令解码（ID）。该指令被解码，配置剩余阶段以完成需要完成的操作。这会执行诸如识别所使用的寄存器并将它们锁存到后面的阶段、在不需要时关闭后面的阶段等事情。</p></li><li><p>执行（EX）。执行实际计算，通常是算术或按位运算。执行阶段最多有两个输入（连接到 ID 中所需的寄存器）和一个输出。对于内存访问指令 LOAD 和 STORE，EX 阶段通过将基地址立即数添加到偏移寄存器来计算地址</p></li><li><p>内存访问 (MEM)。访问内存，将内存中的值加载到寄存器中，或将寄存器中的值加载到内存中。</p></li><li><p>回写（WB）。 EX 阶段的结果被写回输出寄存器。</p></li><li></li></ul><p>MIPS CPU 的设计使得每个阶段只需 1 个时钟周期即可执行。因此，每条正常指令将在 5 个周期内执行。</p><p>一个简单的执行模型是：每条指令在下一条指令开始之前运行所有五个周期。这将导致像这样的执行（两条指令，I1 后跟 I2）：</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture11-instruction-level-parallelism.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 119160524@qq.com">zgjsxx</span><!--]--><!--]--></div></div></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Code Building</div><div class="copyright">Copyright © 2024 程序员小x</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-d7ca8ce0.js" defer></script>
  </body>
</html>

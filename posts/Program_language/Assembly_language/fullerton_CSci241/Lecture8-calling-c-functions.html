<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html"><meta property="og:site_name" content="Code Building"><meta property="og:title" content="ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦"><meta property="og:description" content="ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦ å‡½æ•°è°ƒç”¨è§„çº¦ æ ˆæ“ä½œ æ±‡ç¼–ä¸­çš„æ’åº æ£€æŸ¥æ’åºæƒ…å†µ æ’å…¥æ’åº äºŒåˆ†æŸ¥æ‰¾ C å…¼å®¹å‡½æ•° callå’Œret æ ˆæ–¹å‘ æ ˆå¯¹é½ å¶å‡½æ•° ä¼ é€’å‚æ•° è¿”å›å€¼ æ ˆå¸§ å‡½æ•°æ¨¡æ¿ ä¸ C å‡½æ•°äº’æ“ä½œ é™„å½• è¯¾ç¨‹èµ„æº"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-11T03:25:49.000Z"><meta property="article:modified_time" content="2024-03-11T03:25:49.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦","image":[""],"dateModified":"2024-03-11T03:25:49.000Z","author":[]}</script><title>ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦ | Code Building</title><meta name="description" content="ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦ å‡½æ•°è°ƒç”¨è§„çº¦ æ ˆæ“ä½œ æ±‡ç¼–ä¸­çš„æ’åº æ£€æŸ¥æ’åºæƒ…å†µ æ’å…¥æ’åº äºŒåˆ†æŸ¥æ‰¾ C å…¼å®¹å‡½æ•° callå’Œret æ ˆæ–¹å‘ æ ˆå¯¹é½ å¶å‡½æ•° ä¼ é€’å‚æ•° è¿”å›å€¼ æ ˆå¸§ å‡½æ•°æ¨¡æ¿ ä¸ C å‡½æ•°äº’æ“ä½œ é™„å½• è¯¾ç¨‹èµ„æº">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-646e803e.css" as="style"><link rel="stylesheet" href="/assets/style-646e803e.css">
    <link rel="modulepreload" href="/assets/app-13c30fd9.js"><link rel="modulepreload" href="/assets/framework-9a29aaa0.js"><link rel="modulepreload" href="/assets/Lecture8-calling-c-functions.html-e4df56b5.js"><link rel="modulepreload" href="/assets/Lecture8-calling-c-functions.html-37343523.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Code Building"><!----><span class="site-name hide-in-pad">Code Building</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ç¨‹åºå‘˜å°x"><span class="font-icon icon iconfont icon-home" style=""></span>ç¨‹åºå‘˜å°x<!----></a></div><div class="nav-item hide-in-mobile"><a href="/demo/" class="nav-link" aria-label="æ¼”ç¤º"><span class="font-icon icon iconfont icon-discover" style=""></span>æ¼”ç¤º<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åšæ–‡"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>åšæ–‡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/network" class="nav-link" aria-label="è®¡ç®—æœºç½‘ç»œ"><span class="font-icon icon iconfont icon-edit" style=""></span>è®¡ç®—æœºç½‘ç»œ<!----></a></li><li class="dropdown-item"><a href="/posts/Program_language/cpp" class="nav-link" aria-label="c++"><span class="font-icon icon iconfont icon-edit" style=""></span>c++<!----></a></li><li class="dropdown-item"><a href="/posts/design-pattern" class="nav-link" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon iconfont icon-edit" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></li><li class="dropdown-item"><a href="/posts/tool" class="nav-link" aria-label="å·¥å…·"><span class="font-icon icon iconfont icon-edit" style=""></span>å·¥å…·<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/compile" class="nav-link" aria-label="ç¼–è¯‘åŸç†"><span class="font-icon icon iconfont icon-edit" style=""></span>ç¼–è¯‘åŸç†<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/kernel/Linux-0.11" class="nav-link" aria-label="Linux-0.11è¯¦è§£"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux-0.11è¯¦è§£<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/application-dev" class="nav-link" aria-label="Linuxåº”ç”¨å±‚å¼€å‘"><span class="font-icon icon iconfont icon-edit" style=""></span>Linuxåº”ç”¨å±‚å¼€å‘<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://meiriyiwen.com/" rel="noopener noreferrer" target="_blank" aria-label="æ¯æ—¥ä¸€æ–‡" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>æ¯æ—¥ä¸€æ–‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/posts/about/about.html" class="nav-link" aria-label="å…³äºä½œè€…"><span class="font-icon icon iconfont icon-about" style=""></span>å…³äºä½œè€…<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://zgjsxx.github.io" target="_blank" rel="noopener noreferrer">ç¨‹åºå‘˜å°x</a></span><span property="author" content="ç¨‹åºå‘˜å°x"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-02-29T07:54:55.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 19 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT19M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category5 clickable" role="navigation">æ±‡ç¼–è¯­è¨€</span><meta property="articleSection" content="æ±‡ç¼–è¯­è¨€"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#å‡½æ•°è°ƒç”¨è§„çº¦" class="router-link-active router-link-exact-active toc-link level2">å‡½æ•°è°ƒç”¨è§„çº¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ ˆæ“ä½œ" class="router-link-active router-link-exact-active toc-link level2">æ ˆæ“ä½œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ±‡ç¼–ä¸­çš„æ’åº" class="router-link-active router-link-exact-active toc-link level2">æ±‡ç¼–ä¸­çš„æ’åº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ£€æŸ¥æ’åºæƒ…å†µ" class="router-link-active router-link-exact-active toc-link level2">æ£€æŸ¥æ’åºæƒ…å†µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ’å…¥æ’åº" class="router-link-active router-link-exact-active toc-link level2">æ’å…¥æ’åº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#äºŒåˆ†æŸ¥æ‰¾" class="router-link-active router-link-exact-active toc-link level2">äºŒåˆ†æŸ¥æ‰¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#c-å…¼å®¹å‡½æ•°" class="router-link-active router-link-exact-active toc-link level2">C å…¼å®¹å‡½æ•°</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#callå’Œret" class="router-link-active router-link-exact-active toc-link level3">callå’Œret</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ ˆæ–¹å‘" class="router-link-active router-link-exact-active toc-link level3">æ ˆæ–¹å‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ ˆå¯¹é½" class="router-link-active router-link-exact-active toc-link level3">æ ˆå¯¹é½</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#å¶å‡½æ•°" class="router-link-active router-link-exact-active toc-link level3">å¶å‡½æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#ä¼ é€’å‚æ•°" class="router-link-active router-link-exact-active toc-link level3">ä¼ é€’å‚æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#è¿”å›å€¼" class="router-link-active router-link-exact-active toc-link level3">è¿”å›å€¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#æ ˆå¸§" class="router-link-active router-link-exact-active toc-link level3">æ ˆå¸§</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#å‡½æ•°æ¨¡æ¿" class="router-link-active router-link-exact-active toc-link level2">å‡½æ•°æ¨¡æ¿</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#ä¸-c-å‡½æ•°äº’æ“ä½œ" class="router-link-active router-link-exact-active toc-link level3">ä¸ C å‡½æ•°äº’æ“ä½œ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#é™„å½•" class="router-link-active router-link-exact-active toc-link level2">é™„å½•</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.html#è¯¾ç¨‹èµ„æº" class="router-link-active router-link-exact-active toc-link level3">è¯¾ç¨‹èµ„æº</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><ul><li><a href="#%E7%AC%AC%E5%85%AB%E8%AE%B2--%E6%A0%88%E7%9A%84%E7%BB%93%E6%9E%84-c%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%A7%84%E7%BA%A6">ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦</a><ul><li><a href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%A7%84%E7%BA%A6">å‡½æ•°è°ƒç”¨è§„çº¦</a></li><li><a href="#%E6%A0%88%E6%93%8D%E4%BD%9C">æ ˆæ“ä½œ</a></li><li><a href="#%E6%B1%87%E7%BC%96%E4%B8%AD%E7%9A%84%E6%8E%92%E5%BA%8F">æ±‡ç¼–ä¸­çš„æ’åº</a></li><li><a href="#%E6%A3%80%E6%9F%A5%E6%8E%92%E5%BA%8F%E6%83%85%E5%86%B5">æ£€æŸ¥æ’åºæƒ…å†µ</a></li><li><a href="#%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F">æ’å…¥æ’åº</a></li><li><a href="#%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE">äºŒåˆ†æŸ¥æ‰¾</a></li><li><a href="#c-%E5%85%BC%E5%AE%B9%E5%87%BD%E6%95%B0">C å…¼å®¹å‡½æ•°</a><ul><li><a href="#call%E5%92%8Cret"><code>call</code>å’Œ<code>ret</code></a></li><li><a href="#%E6%A0%88%E6%96%B9%E5%90%91">æ ˆæ–¹å‘</a></li><li><a href="#%E6%A0%88%E5%AF%B9%E9%BD%90">æ ˆå¯¹é½</a></li><li><a href="#%E5%8F%B6%E5%87%BD%E6%95%B0">å¶å‡½æ•°</a></li><li><a href="#%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0">ä¼ é€’å‚æ•°</a></li><li><a href="#%E8%BF%94%E5%9B%9E%E5%80%BC">è¿”å›å€¼</a></li><li><a href="#%E6%A0%88%E5%B8%A7">æ ˆå¸§</a></li></ul></li><li><a href="#%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF">å‡½æ•°æ¨¡æ¿</a><ul><li><a href="#%E4%B8%8E-c-%E5%87%BD%E6%95%B0%E4%BA%92%E6%93%8D%E4%BD%9C">ä¸ C å‡½æ•°äº’æ“ä½œ</a></li></ul></li><li><a href="#%E9%99%84%E5%BD%95">é™„å½•</a><ul><li><a href="#%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%BA%90">è¯¾ç¨‹èµ„æº</a></li></ul></li></ul></li></ul><h1 id="ç¬¬å…«è®²-æ ˆçš„ç»“æ„-cå‡½æ•°è°ƒç”¨è§„çº¦" tabindex="-1"><a class="header-anchor" href="#ç¬¬å…«è®²-æ ˆçš„ç»“æ„-cå‡½æ•°è°ƒç”¨è§„çº¦" aria-hidden="true">#</a> ç¬¬å…«è®² ï¼š æ ˆçš„ç»“æ„ cå‡½æ•°è°ƒç”¨è§„çº¦</h1><h2 id="å‡½æ•°è°ƒç”¨è§„çº¦" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°è°ƒç”¨è§„çº¦" aria-hidden="true">#</a> å‡½æ•°è°ƒç”¨è§„çº¦</h2><p>å›é¡¾ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»é€‰æ‹©ä¸€äº›å¯„å­˜å™¨ç”¨äºå‚æ•°ï¼Œè‡³å°‘ä¸€ä¸ªç”¨äºè¿”å›å€¼ï¼Œä¸€äº›å¯„å­˜å™¨ç”¨äºè°ƒç”¨è€…ä¿å­˜(caller-saved), å¯ä¾›å‡½æ•°ä¸´æ—¶ä½¿ç”¨ï¼Œä¸€äº›å¯„å­˜å™¨ç”¨äºè¢«è°ƒç”¨è€…å·²ä¿å­˜(callee-saved)ã€‚æˆ‘ä»¬å¯¹è¿™äº›å‡½æ•°çš„é€‰æ‹©æ˜¯ä¸ºäº†ä¸æ ‡å‡† Unix C ABI è°ƒç”¨çº¦å®šä¿æŒä¸€è‡´ï¼Œå› æ­¤ï¼Œé€šè¿‡æ›´å¤šçš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å‡½æ•°å°†ä¸ C æ ‡å‡†åº“å…¼å®¹ã€‚ã€</p><table><thead><tr><th>å¯„å­˜å™¨</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td><code>rax</code></td><td>ç”¨äºå‡½æ•°è¿”å›å€¼</td></tr><tr><td><code>rbx</code></td><td>callee-preserved</td></tr><tr><td><code>rcx</code></td><td>å‡½æ•°ç¬¬å››ä¸ªå‚æ•°</td></tr><tr><td><code>rdx</code></td><td>å‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°</td></tr><tr><td><code>rsi</code></td><td>å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°</td></tr><tr><td><code>rdi</code></td><td>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°</td></tr><tr><td><code>rbp</code></td><td>callee-preserved</td></tr><tr><td><code>rsp</code></td><td>æ ˆé¡¶æŒ‡é’ˆ</td></tr><tr><td><code>r8</code></td><td>å‡½æ•°ç¬¬äº”ä¸ªå‚æ•°</td></tr><tr><td><code>r9</code></td><td>å‡½æ•°ç¬¬å…­ä¸ªå‚æ•°</td></tr><tr><td><code>r10</code></td><td>ä¸´æ—¶å˜é‡(caller-preserved)</td></tr><tr><td><code>r11</code></td><td>ä¸´æ—¶å˜é‡(caller-preserved)</td></tr><tr><td><code>r12-r15</code></td><td>Callee-preserved</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€ä»¥çš„å‡½æ•°è¿”å›å€¼å’Œå‡½æ•°çš„å…¥å‚éƒ½ç®—ä½œcaller-preservedå¯„å­˜å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„å‡½æ•°æ­£åœ¨ä½¿ç”¨ <code>rcx</code> å¹¶ä¸”æ‚¨æƒ³è¦è°ƒç”¨å‡½æ•°ï¼Œåˆ™å¿…é¡»ä¿ç•™ <code>rcx</code>ï¼Œå³ä½¿è¯¥å‡½æ•°ä¸ä½¿ç”¨å®ƒä½œä¸ºå‚æ•°ã€‚</p><p>è°ƒç”¨å‡½æ•°çš„ä¸€èˆ¬æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>...
    push r10        ; Push any caller-saved registers in use
    call func   
    pop r10         ; Restore after return
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç±»ä¼¼åœ°ï¼Œåœ¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¿å­˜æ‰€æœ‰call-preservedçš„å¯„å­˜å™¨ï¼Œç­‰å‡½æ•°æ‰§è¡Œå®Œåå†æ¢å¤å®ƒä»¬ã€‚</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>func:
    push r12        ; Push any callee-saved registers in use
    ...
    pop r12         ; Restore them before return
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œä½¿æˆ‘ä»¬çš„å‡½æ•°ä¸ C å…¼å®¹å°†éœ€è¦å¯¹å‡½æ•°å‰å¯¼ç /åºè¨€è¿›è¡Œä¸€äº›æ›´æ”¹æ‰èƒ½æ­£ç¡®è®¾ç½®æ ˆã€‚</p><h2 id="æ ˆæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#æ ˆæ“ä½œ" aria-hidden="true">#</a> æ ˆæ“ä½œ</h2><p>è¦æ‰‹åŠ¨å‘æ ˆæ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>push</code>å’Œ<code>pop</code>æŒ‡ä»¤ï¼š</p><ul><li><p><code>push op</code>ï¼šå°†æ“ä½œæ•° <code>op</code> å‹å…¥å †æ ˆã€‚è¿™ä¸ªæ“ä½œå°†<code>rsp</code>å‡å°‘<code>op</code>çš„å¤§å°ï¼Œ ç„¶åæ‰§è¡Œ <code>mov [rsp] op</code>ã€‚<code>op</code> ä¸èƒ½æ˜¯ 64 ä½ç«‹å³æ•°ï¼Œä½†å¯ä»¥æ˜¯æ›´å°çš„ç«‹å³æ•°ï¼ˆ8ã€16 æˆ– 32 ä½ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¸èƒ½æ¨é€å­—èŠ‚å¤§å°çš„å¯„å­˜å™¨æˆ–å†…å­˜æ“ä½œæ•°ï¼Œä½†å¯ä»¥æ¨é€å­—èŠ‚å¤§å°çš„ç«‹å³æ•°ã€‚</p></li><li><p><code>pop op</code>: å°†æ ˆé¡¶å€¼å¼¹å‡ºåˆ° <code>op</code> ä¸­ã€‚å³ï¼Œæ‰§è¡Œ <code>mov op [rsp]</code>ï¼Œç„¶åå°† <code>rsp</code> å¢åŠ  <code>op</code> çš„å¤§å°ã€‚<code>op</code> æ˜¾ç„¶ä¸èƒ½æ˜¯ç«‹å³æ•°ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ä¸€ä¸ªå­—æˆ–æ›´å¤§çš„ã€‚</p></li></ul><p>è¯·æ³¨æ„ï¼Œåœ¨ x86-64 ä¸­ï¼Œå †æ ˆä»å†…å­˜çš„æœ«å°¾å¼€å§‹å¹¶å‘åå¢é•¿ï¼Œå› æ­¤å…¥æ ˆä¼šå‡å°‘<code>rsp</code>ï¼Œå‡ºæ ˆä¼šå¢åŠ  <code>rsp</code>ã€‚å› æ­¤ï¼Œä¸ºäº†å‘ä¸‹æŸ¥çœ‹å †æ ˆï¼Œæˆ‘ä»¬å°†è®¿é—® <code>rsp</code> + ä¸€æ®µè·ç¦»ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥åœ¨ä¸ä½¿ç”¨è¿™äº›æŒ‡ä»¤çš„æƒ…å†µä¸‹éšæ„ä¿®æ”¹å †æ ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¸Œæœ›å°†å‰ 8 ä¸ªå­—èŠ‚ä»å †æ ˆä¸­å¼¹å‡ºï¼Œä½†ä¸å…³å¿ƒå®ƒä»¬çš„å€¼ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°æ‰§è¡Œä»¥ä¸‹æ“ä½œ</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>add rsp, 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯¥å‘½ä»¤ä¼šå°† <code>rsp</code> å¢é•¿ 8ã€‚</p><p>äº‹å®ä¸Šï¼Œæ ˆä»è¿›ç¨‹åœ°å€ç©ºé—´çš„æœ«å°¾å¼€å§‹å¹¶å‘åå¢é•¿ï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨åœ¨ä»»ä½•æ—¶å€™æŸ¥çœ‹ rspï¼Œå®ƒå¯èƒ½ä¼šå¾ˆå¤§ï¼ˆå¤§çº¦ TB çº§ï¼‰ã€‚è¿™å¹¶ä¸æ„å‘³ç€æ‚¨çš„è¿›ç¨‹å®é™…ä¸Šå¯ä»¥ä½¿ç”¨é‚£ä¹ˆå¤šå†…å­˜ï¼›è€Œæ˜¯æ„å‘³ç€æ‚¨çš„è¿›ç¨‹å®é™…ä¸Šå¯ä»¥ä½¿ç”¨é‚£ä¹ˆå¤šå†…å­˜ã€‚æ­£å¦‚æˆ‘ä»¬ç¨åå°†çœ‹åˆ°çš„ï¼Œç³»ç»Ÿæœ‰ä¸€ç§æ–¹æ³•ä¸åˆ†é…æœªä½¿ç”¨çš„å†…å­˜éƒ¨åˆ†ã€‚</p><h2 id="æ±‡ç¼–ä¸­çš„æ’åº" tabindex="-1"><a class="header-anchor" href="#æ±‡ç¼–ä¸­çš„æ’åº" aria-hidden="true">#</a> æ±‡ç¼–ä¸­çš„æ’åº</h2><p>ä¸ºäº†å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°†å¼€å‘å‡ ä¸ª 133 ç§ç®—æ³•åˆ°å®ƒä»¬çš„æ±‡ç¼–ç­‰ä»·ç‰©ä¸­ã€‚è¿™æ˜¯æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„åºè¨€ï¼š</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>section .data

; Load 1M of random data from random.dat

data:           incbin                  &quot;random.dat&quot;
DATLEN:         equ                     $-data

section .text
global _start
_start:
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¸éœ€è¦éº»çƒ¦åœ°ä½¿ç”¨ <code>open/read</code> ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯ç›´æ¥å°†éšæœºæ•°æ®ç¼–è¯‘åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚</p><h2 id="æ£€æŸ¥æ’åºæƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#æ£€æŸ¥æ’åºæƒ…å†µ" aria-hidden="true">#</a> æ£€æŸ¥æ’åºæƒ…å†µ</h2><p>æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªæ’åºç®—æ³•ï¼Œä½†æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æ£€æŸ¥å®ƒæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå‡½æ•° <code>is_sorted</code>ï¼Œå¦‚æœè¾“å…¥æ•°ç»„å·²æ’åºï¼Œå®ƒå°†æŠŠ <code>rax</code> è®¾ç½®ä¸º 1ï¼Œå¦‚æœæ²¡æœ‰æ’åºï¼Œåˆ™å°†è®¾ç½® <code>rax</code> ä¸º 0ã€‚å®ƒå°†æ¥æ”¶æ•°ç»„çš„åœ°å€ï¼ˆ<code>rdi</code>ï¼‰å’Œé•¿åº¦ï¼ˆ<code>rsi</code>ï¼‰ã€‚æˆ‘ä»¬å°†è®¤ä¸ºè¯¥æ•°ç»„ç”±å¸¦ç¬¦å·çš„ qwordï¼ˆæ¯ä¸ªæ•°ç»„æ¡ç›® 8 ä¸ªå­—èŠ‚ï¼‰ç»„æˆã€‚</p><p>åœ¨ C/C++ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹æ³•æ£€æŸ¥è¿™æ ·çš„æ•°ç»„:</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token function">is_sorted</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> arr<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token operator">++</span>i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éé¡ºåºæ‰§è¡Œæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœ while æ¡ä»¶ä¸ºå‡ï¼Œæˆ‘ä»¬è·³è½¬åˆ°æœ€ç»ˆçš„è¿”å›ã€‚</li><li>åœ¨å¾ªç¯ç»“æŸæ—¶ï¼Œæˆ‘ä»¬ï¼ˆæ— æ¡ä»¶ï¼‰è·³å›åˆ°å¼€å¤´ã€‚</li><li>å¦‚æœ if æ¡ä»¶ä¸º falseï¼Œåˆ™è·³è½¬åˆ°å¾ªç¯æœ«å°¾çš„ i++ã€‚</li></ul><p>åœ¨æ±‡ç¼–ä¸­ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸œè¥¿:</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>is_sorted:

    ; rdi = address of array
    ; rsi = length (in bytes)
    ; Returns: rax = 1 if sorted

    sub rsi, 8          ; Last element
    mov rax, 0
.while:
        cmp rax, rsi
        je .done

        mov r8, qword [rax + rdi]
        mov r9, qword [rax + rdi + 8]
        cmp r8, r9
        jle .continue
        mov rax, 0        
        ret

    .continue:
        add rax, 8
        jmp .while

.done:
    mov rax, 1
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä½¿ç”¨å†…å­˜æ“ä½œæ•°çš„æ‰©å±•å½¢å¼æ¥ç®€åŒ–æ•°ç»„æŸ¥æ‰¾ã€‚ç‰¹åˆ«æ˜¯ï¼Œå†…å­˜æ“ä½œæ•°å¯ä»¥ç”±ä»¥ä¸‹æ€»å’Œç»„æˆï¼š</p><ul><li>å¸¸é‡åœ°å€</li><li>æœ€å¤šä¸¤ä¸ªå¯„å­˜å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªç§°ä¸ºåŸºå€å¯„å­˜å™¨ï¼Œå¦ä¸€ä¸ªç§°ä¸ºç´¢å¼•å¯„å­˜å™¨</li><li>ç´¢å¼•å¯„å­˜å™¨å¯ä»¥ä¹˜ä»¥ 1ã€2ã€4 æˆ– 8ã€‚</li></ul><p>ç”±äºå“ªäº›å¯„å­˜å™¨å¯ä»¥ä½œä¸ºåŸºå€å’Œç´¢å¼•æ²¡æœ‰é™åˆ¶ï¼Œæ‰€ä»¥å®é™…ä¸Šï¼Œå…¶ä¸­ä¸€ä¸ªå¯„å­˜å™¨å¯ä»¥ç›¸ä¹˜ï¼Œè€Œå¦ä¸€ä¸ªåˆ™ä¸èƒ½ã€‚</p><p>æ±‡ç¼–ä»£ç å’Œ C/C++ ä»£ç ä¹‹é—´æœ‰ä¸€ä¸ªåŒºåˆ«ï¼šæ±‡ç¼–ä»£ç ä¸­çš„é•¿åº¦ä»¥å­—èŠ‚æ•°ç»™å‡ºï¼Œè€Œä¸æ˜¯æ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚åœ¨æ±‡ç¼–ä¾‹ç¨‹ä¸­ï¼Œæ— è®ºå…ƒç´ çš„å®é™…å¤§å°å¦‚ä½•ï¼Œéƒ½ä»¥å­—èŠ‚ä¸ºå•ä½ç»™å‡ºé•¿åº¦æ˜¯ç›¸å½“å¸¸è§çš„ã€‚</p><h2 id="æ’å…¥æ’åº" tabindex="-1"><a class="header-anchor" href="#æ’å…¥æ’åº" aria-hidden="true">#</a> æ’å…¥æ’åº</h2><p>æˆ‘ä»¬å°†å®ç°æ’å…¥æ’åºã€‚åœ¨ C++ ä¸­ï¼Œæ’å…¥æ’åºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">insertion_sort</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        j <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> arr<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                std<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token operator">--</span>j<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token operator">++</span>i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆæˆ‘ä½¿ç”¨ while å¾ªç¯ç¼–å†™æ­¤ä»£ç ï¼Œä»¥ä¾¿æ›´å®¹æ˜“è½¬æ¢ä¸ºæ±‡ç¼–è¯­è¨€ï¼›ç”¨ C/C++ ç¼–å†™å®ƒçš„è‡ªç„¶æ–¹æ³•æ˜¯ä½¿ç”¨ for å¾ªç¯ã€‚ï¼‰</p><p>åœ¨æ±‡ç¼–ä¸­ï¼Œ while å¾ªç¯å…·æœ‰ä»¥ä¸‹ç»“æ„:</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>.while:
    cmp ...
    jcc .end_while

        ...

    jmp .while
.end_while
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†ä¸æˆ‘ä»¬çš„å‡½æ•°è°ƒç”¨çº¦å®šä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬çš„å‡½æ•°å°†æ¥æ”¶ rdi ä¸­çš„æ•°ç»„åœ°å€å’Œ rsi ä¸­çš„å¤§å°ï¼ˆæ— ç¬¦å·ï¼‰ã€‚</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>insertion_sort:
    ; rdi = addr of array
    ; rsi = length of array

    mov rax, 1          ; rax = outer loop index, unsigned

    .while_i:
        cmp rax, rsi
        je .done
        mov rbx, rax    ; rbx = inner loop index

        .while_j:
            cmp rbx, 0
            je .done_i

            mov r8, qword [rdi + 8*rbx]
            mov r9, qword [rdi + 8*rbx - 8]
            cmp r8,r9
            jge .done_i ; break

            ; swap
            mov qword [rdi + 8*rbx],     r9
            mov qword [rdi + 8*rbx - 8], r8

            dec rbx
            jmp .while_j

    .done_i:
        inc rax
        jmp .while_i

.done
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒåˆ†æŸ¥æ‰¾" tabindex="-1"><a class="header-anchor" href="#äºŒåˆ†æŸ¥æ‰¾" aria-hidden="true">#</a> äºŒåˆ†æŸ¥æ‰¾</h2><p>å®ç°äºŒåˆ†æœç´¢å…è®¸æˆ‘ä»¬ä½¿ç”¨å¦ä¸€ç§æ¡ä»¶æ“ä½œï¼šæ¡ä»¶ç§»åŠ¨ã€‚æ¡ä»¶è·³è½¬æœ‰ç‚¹æ˜‚è´µï¼Œå› ä¸º CPU æ— æ³•åœ¨è·³è½¬åé¢„åŠ è½½æŒ‡ä»¤ï¼Œç›´åˆ°å®ƒæœ¬èº«å¤„ç†äº†æ¡ä»¶è·³è½¬ã€‚æ¡ä»¶ç§»åŠ¨æ˜¯é™„åŠ äº†æ¡ä»¶ä»£ç çš„ç§»åŠ¨ï¼›ä»…å½“æ¡ä»¶ä¸ºçœŸæ—¶æ‰ä¼šå‘ç”Ÿç§»åŠ¨ã€‚æ¡ä»¶ç§»åŠ¨æŒ‡ä»¤ä¸º cmov**ï¼Œå…¶ä¸­ ** æ˜¯æ¡ä»¶ä»£ç ä¹‹ä¸€ã€‚</p><p>ä½œä¸ºå‚è€ƒï¼ŒC++ ä¸­äºŒåˆ†æŸ¥æ‰¾çš„å®ç°æ˜¯:</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token function">binary_search</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">,</span> <span class="token keyword">long</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> high <span class="token operator">=</span> len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> mid<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>low <span class="token operator">&lt;</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> low<span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span>
            high <span class="token operator">=</span> mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">==</span> arr<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> mid<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            low <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>low<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">)</span>
        <span class="token keyword">return</span> low<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 0xffffffff... </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆé€šå¸¸æˆ‘ä»¬ä¼šå°†æ¡ä»¶å†™ä¸º low &lt;= high å¹¶è·³è¿‡æœ€åçš„ ifï¼Œä½†æ˜¯ï¼Œå¦‚æœ low å’Œ high éƒ½æ˜¯æ— ç¬¦å·çš„ï¼Œé‚£ä¹ˆå¦‚æœ high == 0 å¹¶ä¸”æˆ‘ä»¬æ‰§è¡Œ high - 1ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° high = 0xfffff...ï¼Œå¹¶ä¸”æ‰€ä»¥æ¡ä»¶æ°¸è¿œä¸ä¼šæ˜¯å‡çš„ã€‚ï¼‰</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>binary_search:

    ; rdi = address of array
    ; rsi = length of array
    ; dl = target to search for

    mov rax, 0          ; rax = low = 0
    mov rbx, rsi        ; rbx = high = len-1
    dec rbx;

.while:
    cmp rax, rbx
    jae .not_found      ; Stop if rax &gt; rbx

    ; rcx = mid = (high - low)/2 + low
    mov rcx, rbx        ; rcx = high
    sub rcx, rax        ; rcx -= low
    shr rcx, 1          ; rcx /= 2
    add rcx, rax        ; rcx += low                        

    mov r14, rcx        ; r14 = mid+1
    inc r14
    mov r15, rcx        ; r15 = mid-1
    dec r15

    cmp rdx, qword [rdi + 8*rcx] ; compare target, arr[mid]
    cmovg rax, r14               ; target &gt; arr [mid] ===&gt; low = mid+1
    cmovl rbx, r15               ; target &lt; arr [mid] ===&gt; high = mid-1
    cmove rax, rcx               ; target == arr[mid] ===&gt; rax = mid (index)
    je .return                   ; target == arr[mid] ===&gt; return

    jmp .while
.not_found:
    cmp qword [rdi + 8*rax], rdx
    je .return

    mov rax, -1
.return:
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç éƒ¨åˆ†</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>    mov r14, rcx        ; r14 = mid+1
    inc r14
    mov r15, rcx        ; r15 = mid-1
    dec r15
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>;;;;
;;;; sort_search.s
;;;; Sorting and searching in assembly.
;;;;
section .data

data:           incbin                  &quot;random.dat&quot;
DATLEN:         equ                     ($-data) / 8

sorted:         dq      1,9,2,8,3,7,4,6,5
SORTLEN:        equ     ($-sorted)/8

section .text

;;; _start
;;; Program entry point
global _start
_start:

    mov rdi, data
    mov rsi, DATLEN
    call insertion_sort

    mov rdi, data
    mov rsi, DATLEN
    mov rdx, 10000
    call linear_search
    mov r10, rax ; Save index

    mov rdi, data
    mov rsi, DATLEN
    mov rdx, 10000
    call binary_search

    mov r8, 0
    mov r9, 1
    cmp rax, r10
    cmove rdi, r8
    cmovne rdi, r9  

    ; Exit with sorted-ness in exit code    
    mov rax, 60
    syscall 

;;; is_sorted
;;; Returns true if an array is sorted.
;;;
;;; rdi = address
;;; rsi = length
;;; Returns: rax = 1 if sorted, 0 otherwise.
is_sorted:

    ; rdi = address of array
    ; rsi = length
    ; Returns: rax = 1 if sorted

    dec rsi
    mov rax, 0
.while:
        cmp rax, rsi
        je .done

        mov r8, qword [8*rax + rdi]
        mov r9, qword [8*rax + rdi + 8]
        cmp r8, r9
        jle .continue
        mov rax, 0        
        ret

    .continue:
        inc rax
        jmp .while

.done:
    mov rax, 1
    ret

;;; insertion_sort
;;; Sorts and array of qwords
;;; rdi = address
;;; rsi = length
;;; Returns nothing
insertion_sort:
    ; rdi = addr of array
    ; rsi = length of array

    mov rax, 1          ; rax = outer loop index, unsigned

    .while_i:
        cmp rax, rsi
        je .done
        mov rbx, rax    ; rbx = inner loop index

        .while_j:
            cmp rbx, 0
            je .done_i

            mov r8, qword [rdi + 8*rbx]
            mov r9, qword [rdi + 8*rbx - 8]
            cmp r8,r9
            jge .done_i ; break

            ; swap
            mov qword [rdi + 8*rbx],     r9
            mov qword [rdi + 8*rbx - 8], r8

            dec rbx
            jmp .while_j

    .done_i:
        inc rax
        jmp .while_i

.done
    ret

;;; binary_search
;;; Does a binary search over an array for a target value
;;; rdi = address
;;; rsi = length
;;; rdx = target
;;; Returns: index of target or -1 (0xfffff...) if not found
binary_search:

    ; rdi = address of array
    ; rsi = length of array
    ; dl = target to search for

    mov rax, 0          ; rax = low = 0
    mov rbx, rsi        ; rbx = high = len-1
    dec rbx;

.while:
    cmp rax, rbx
    jae .not_found      ; Stop if rax &gt; rbx

    ; rcx = mid = (high - low)/2 + low
    mov rcx, rbx        ; rcx = high
    sub rcx, rax        ; rcx -= low
    shr rcx, 1          ; rcx /= 2
    add rcx, rax        ; rcx += low                        

    mov r14, rcx        ; r14 = mid+1
    inc r14
    mov r15, rcx        ; r15 = mid-1
    dec r15

    cmp rdx, qword [rdi + 8*rcx] ; compare target, arr[mid]
    cmovg rax, r14               ; target &gt; arr [mid] ===&gt; low = mid+1
    cmovl rbx, r15               ; target &lt; arr [mid] ===&gt; high = mid-1
    cmove rax, rcx               ; target == arr[mid] ===&gt; rax = mid (index)
    je .return                   ; target == arr[mid] ===&gt; return

    jmp .while
.not_found:
    cmp qword [rdi + 8*rax], rdx
    je .return

    mov rax, -1
.return:
    ret

;;; linear_search
;;; Does a linear search in an array.
;;; rdi = address
;;; rsi = length
;;; rdx = target
;;; Returns rax = index of target or -1 (0xffff...) if not found
linear_search:
    ; rdi = address of array
    ; rsi = length of array
    ; dl = target to search for
    ; Returns: rax = index of target, or -1 (0xffff...) if not found

    mov rax, 0  ; Index

    .while:
        cmp rax, rsi
        je .not_found

        cmp rdx, qword [rdi + 8*rax]
        jne .continue       ; Not equal: next iteration
        ret                 ; Equal, return current rax

    .continue:
        inc rax        
        jmp .while
    .not_found:
    mov rax, -1
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="c-å…¼å®¹å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#c-å…¼å®¹å‡½æ•°" aria-hidden="true">#</a> C å…¼å®¹å‡½æ•°</h2><p>æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæ±‡ç¼–ä¸­çš„å‡½æ•°çš„è¿è¡Œçº§åˆ«æ¯” C æˆ– C++ ä¸­çš„ä½å¾—å¤šã€‚æˆ‘ä»¬å¿…é¡»å­¦ä¹ å¦‚ä½•æ‰‹åŠ¨ç®¡ç†å‡½æ•°ä½¿ç”¨çš„æ ˆç©ºé—´ã€‚</p><h3 id="callå’Œret" tabindex="-1"><a class="header-anchor" href="#callå’Œret" aria-hidden="true">#</a> <code>call</code>å’Œ<code>ret</code></h3><p>å®ç°å‡½æ•°è°ƒç”¨çš„åŸºæœ¬æŒ‡ä»¤æ˜¯<code>call</code>å’Œ<code>ret</code>ï¼š</p><ul><li><code>call Func</code> å°† IP å¯„å­˜å™¨ <code>rip</code> å‹å…¥å †æ ˆï¼Œç„¶åè·³è½¬åˆ°æ ‡è®° Func å¤„æ‰§è¡Œ</li><li><code>ret</code> å°†æ ˆé¡¶å¼¹å‡ºåˆ° <code>rip</code> ä¸­ï¼Œç„¶åè·³è½¬åˆ° <code>rip</code>ã€‚å› ä¸º <code>rip</code> æ€»æ˜¯æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥è¿™å°†ç«‹å³è·³è½¬åˆ°å°†æˆ‘ä»¬å¸¦å…¥è¯¥å‡½æ•°çš„è°ƒç”¨ä¹‹åçš„æŒ‡ä»¤ã€‚</li></ul><p>åœ¨åº•å±‚ï¼Œæ ˆè®°å½•äº†ç¨‹åºreturnä¹‹åè·³è½¬åˆ°é‚£é‡Œæ‰§è¡Œã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°fä¸­è°ƒç”¨å‡½æ•°gï¼Œåœ¨å‡½æ•°gä¸­è°ƒç”¨å‡½æ•°hï¼Œå½“gå’Œhè¿”å›æ—¶,ç”±äºæ ˆä¸Šä¿ç•™äº†è¿”å›åœ°å€ï¼Œç¨‹åºå¯ä»¥è¿”å›åˆ°å‡½æ•°fåç»§ç»­æ‰§è¡Œã€‚</p><p>è¿™å¹¶ä¸æ˜¯æ ˆçš„å…¨éƒ¨ç”¨é€”ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å°†æ ˆç”¨äºï¼š</p><ul><li>ä¸´æ—¶å­˜å‚¨æˆ‘ä»¬æƒ³è¦ä¿å­˜å¹¶ç¨åæ¢å¤çš„å¯„å­˜å™¨å€¼ã€‚</li><li>å½“å‡½æ•°çš„å‚æ•°å¤šäºä¸ºæ­¤æŒ‡å®šçš„å…­ä¸ªå¯„å­˜å™¨æ‰€å®¹çº³çš„å‚æ•°æ—¶ï¼Œä¼ é€’å‚æ•°ã€‚</li><li>å½“è¿”å›å€¼å¤§äº <code>rdx:rax</code> æ‰€èƒ½å®¹çº³çš„å€¼æ—¶ï¼Œä½¿ç”¨æ ˆä½œä¸ºè¿”å›å€¼</li><li>å±€éƒ¨å˜é‡ï¼Œå½“å±€éƒ¨å˜é‡å¤šäºå¯ç”¨å¯„å­˜å™¨æ—¶ï¼ˆæˆ–è€…å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å±€éƒ¨å˜é‡çš„åœ°å€æ—¶ï¼Œç”±äºå¯„å­˜å™¨æ²¡æœ‰åœ°å€ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨æ ˆï¼‰ã€‚</li></ul><h3 id="æ ˆæ–¹å‘" tabindex="-1"><a class="header-anchor" href="#æ ˆæ–¹å‘" aria-hidden="true">#</a> æ ˆæ–¹å‘</h3><p>æ ˆä»ç¨‹åºå†…å­˜ç©ºé—´çš„æœ«å°¾å¼€å§‹ï¼Œå‘ä¸‹å¢é•¿ã€‚å› æ­¤ï¼Œæ ˆæ“ä½œ<code>push</code>å’Œ<code>pop</code>æœ‰ä»¥ä¸‹æ•ˆæœ:</p><ul><li><code>push x</code>ï¼šä»<code>rsp</code>ä¸­å‡å»xçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œç„¶å<code>mov [rsp], x</code>ã€‚</li><li><code>pop x</code>: <code>mov x, [rsp]</code> ç„¶åå°† x çš„å¤§å°æ·»åŠ åˆ° <code>rsp</code> ä¸­ã€‚</li></ul><p>é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå‹å…¥/å¼¹å‡ºæ“ä½œæ•°çš„å¤§å°ä¼šå½±å“æ ˆæŒ‡é’ˆçš„ç§»åŠ¨æ–¹å¼ã€‚å¦‚æœä½ å‹å…¥ä¸€ä¸ªwordï¼Œ<code>rsp</code>å°†å‡2ã€‚æ‚¨å¯ä»¥<code>push</code>/<code>pop</code>å¯„å­˜å™¨ã€å†…å­˜æ“ä½œæ•°æˆ–ç«‹å³æ•°ï¼Œä½†æœ€å°å¤§å°æ˜¯ä¸€ä¸ªå­—çš„å¤§å°ï¼Œæ‚¨ä¸èƒ½<code>push</code>/<code>pop</code>å•ä¸ªå­—èŠ‚ã€‚</p><h3 id="æ ˆå¯¹é½" tabindex="-1"><a class="header-anchor" href="#æ ˆå¯¹é½" aria-hidden="true">#</a> æ ˆå¯¹é½</h3><p>System-V x86-64 å‡½æ•°è°ƒç”¨è§„èŒƒè¦æ±‚æ ˆé¡¶éƒ¨ï¼ˆå³ <code>rsp</code> ä¸­çš„åœ°å€ï¼‰å§‹ç»ˆä¸ 16 å­—èŠ‚çš„å€æ•°å¯¹é½ï¼Œå¹¶åœ¨ä»»ä½•è°ƒç”¨æŒ‡ä»¤ä¹‹å‰åŠ ä¸Š 8 å­—èŠ‚çš„åç§»é‡ã€‚è¿™æ„å‘³ç€ <code>rsp</code> çš„å€¼å¿…é¡»å§‹ç»ˆå¯è¡¨ç¤ºä¸º:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mi>s</mi><mi>p</mi><mo>=</mo><mn>16</mn><mi>a</mi><mo>+</mo><mn>8</mn></mrow><annotation encoding="application/x-tex"> rsp=16a+8 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">rs</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">16</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span></span></p><p>å°†<code>rsp</code>é™¤ä»¥16ä½™æ•°æ˜¯8ã€‚</p><p>ä½™æ•°æ˜¯ 8 çš„åŸå› æ˜¯è°ƒç”¨æœ¬èº«å°† 8 ä¸ªå­—èŠ‚ä»¥è¿”å›åœ°å€çš„å½¢å¼å‹å…¥æ ˆã€‚åªè¦æˆ‘ä»¬ä¸ä¸ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†äº¤äº’ï¼Œæˆ‘ä»¬å°±ä¸å¿…æ‹…å¿ƒè¿™ä¸€ç‚¹ï¼Œä½†ä¸€æ—¦æˆ‘ä»¬å°è¯•ç¼–å†™ <code>main</code> è€Œä¸æ˜¯ <code>_start</code>ï¼Œæˆ‘ä»¬å°±éœ€è¦éµå¾ªè¿™äº›è§„åˆ™ã€‚</p><p>å½“ç³»ç»Ÿè°ƒç”¨æˆ‘ä»¬çš„ main å‡½æ•°æ—¶ï¼Œå®ƒä¼šä»¥è¿™ç§æ–¹å¼ä¸ºæˆ‘ä»¬è®¾ç½®æ ˆï¼Œä½†éšåå®ƒä¼šç«‹å³push <code>rip</code>ï¼Œä½¿å…¶å†æ¬¡å‡å°‘ 8ã€‚å› æ­¤ï¼Œæ¯ä¸ªå‡½æ•°åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é‡æ–°å¯¹é½å †æ ˆæŒ‡é’ˆï¼Œæˆ–è€…é€šè¿‡ï¼š</p><ul><li>ä» rsp ä¸­å‡å» 8ï¼š <code>sub rsp, 8</code></li><li>å°† rbp å‹å…¥å †æ ˆï¼ˆè§ä¸‹æ–‡ï¼‰ï¼š<code>push rbp</code></li></ul><p>åœ¨è¿”å›ä¹‹å‰ï¼Œå‡½æ•°åº”è¯¥æ’¤æ¶ˆè¿™äº›æ“ä½œï¼Œä»¥ä¾¿å½“ <code>ret</code> å¼¹å‡º <code>rip</code> æ—¶ï¼Œå †æ ˆå°†å†æ¬¡æ­£ç¡®å¯¹é½ã€‚</p><p>ç±»ä¼¼åœ°ï¼Œå¦‚æœæ‚¨å°†å‚æ•°å‹å…¥å †æ ˆï¼ˆè¯·å‚é˜…ä¸‹ä¸€èŠ‚ï¼‰ï¼Œåˆ™å¿…é¡»ç¡®ä¿è°ƒç”¨ä¹‹å‰çš„æœ€ç»ˆ rsp æ­£ç¡®å¯¹é½ï¼Œå¦åˆ™è°ƒç”¨å°†å‡ºç°æ®µé”™è¯¯ï¼Œå› ä¸ºç¼–è¯‘å™¨å·²åœ¨ç¨‹åºé›†ä¸­ç”Ÿæˆå¯¹é½ç§»åŠ¨çš„å‡½æ•°ã€‚</p><h3 id="å¶å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å¶å‡½æ•°" aria-hidden="true">#</a> å¶å‡½æ•°</h3><p>&quot;å¶å­å‡½æ•°&quot;æ˜¯æŒ‡ï¼š</p><ul><li>å°†å…¶æ‰€æœ‰å‚æ•°æ”¾å…¥å¯„å­˜å™¨ä¸­</li><li>å°†å…¶ç»“æœè¿”å›åˆ°å¯„å­˜å™¨ä¸­</li><li>ä¸è°ƒç”¨ä»»ä½•å…¶ä»–å‡½æ•°</li><li>ä¸å°†ä»»ä½•å†…å®¹å‹å…¥å †æ ˆ</li></ul><p>å³ï¼Œå¶å­å‡½æ•°ä¸ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨å †æ ˆã€‚å› æ­¤ï¼Œå¶å­å‡½æ•°å¯ä»¥ä¸å¯¹é½æ ˆæŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥è·³è¿‡è®¾ç½® rbpï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚è¿™å¾ˆå¥½ï¼Œå› ä¸ºå¶å­å‡½æ•°æ°¸è¿œä¸ä¼šè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æˆ–ä½¿ç”¨å †æ ˆã€‚</p><h3 id="ä¼ é€’å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ä¼ é€’å‚æ•°" aria-hidden="true">#</a> ä¼ é€’å‚æ•°</h3><p>ä¼ ç»Ÿä¸Šï¼Œå‚æ•°æ˜¯é€šè¿‡å°†å‚æ•°å‹å…¥å †æ ˆæ¥ä¼ é€’çš„ï¼Œå…¶é¡ºåºä¸ä¼ é€’å‚æ•°çš„é¡ºåºç›¸åã€‚è¿™ä¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶äº§ç”Ÿå¤§é‡å¼€é”€ï¼Œå› ä¸ºå‡½æ•°å¿…é¡»è®¿é—®å†…å­˜æ‰èƒ½è¯»å…¥å…¶å‚æ•°ã€‚x86-64 åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆå®šä¹‰äº†å‡½æ•°è°ƒç”¨çº¦å®šå’Œè®¸å¤šå…¶ä»–æ ‡å‡†æ±‡ç¼–çº§â€œæ¥å£â€ï¼‰å¯¹æ­¤è¿›è¡Œäº†ä¿®æ”¹ï¼Œä»¥ä¾¿ï¼š</p><ul><li>å‰å…­ä¸ªï¼ˆéæµ®ç‚¹ï¼‰å‚æ•°é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œç‰¹åˆ«æ˜¯å¯„å­˜å™¨ <code>rdi</code>ã€<code>rsi</code>ã€<code>rdx</code>ã€<code>rcx</code>ã€<code>r8</code> å’Œ <code>r9</code>ã€‚</li><li>å¦‚æœå‚æ•°å°äº 64 ä½ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ä½¿ç”¨å…¶å„è‡ªå¯„å­˜å™¨çš„é€‚å½“éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œ32 ä½çš„ <code>edi</code>ï¼‰ã€‚</li><li>å‰ 8 ä¸ªæµ®ç‚¹å‚æ•°é€šè¿‡æµ®ç‚¹å¯„å­˜å™¨ <code>xmm0</code> åˆ° <code>xmm7</code> ä¼ é€’ã€‚</li><li>ä»»ä½•å‰©ä½™çš„å‚æ•°éƒ½ä»¥ç›¸åçš„é¡ºåºå‹å…¥å †æ ˆã€‚</li></ul><p>å¤§äº 64 ä½çš„å‚æ•°é€šå¸¸åœ¨å †æ ˆä¸Šæˆ–åœ¨å†…å­˜ä¸­ä½œä¸ºåœ°å€ä¼ é€’ã€‚ç¨åæˆ‘ä»¬å°†ä»‹ç»ä¼ é€’/è¿”å›ç»“æ„ï¼Œä½†åŒæ—¶è¯·å‚é˜… System-V x86-64 ABI ä»¥äº†è§£æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">long</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯¥å‡½æ•°åœ¨è°ƒç”¨/è¿”å›æ—¶ä½¿ç”¨çš„å¯„å­˜å™¨æ˜¯ï¼š</p><ul><li><code>rdi</code>: åŒ…å« <code>x</code> çš„å€¼ï¼ˆå¸¦ç¬¦å·çš„ qwordï¼‰</li><li><code>xmm0</code>: åŒ…å«<code>y</code>çš„å€¼</li><li><code>rsi</code>ï¼š åŒ…å«<code>z</code>çš„å€¼</li><li><code>eax</code>: åŒ…å«äº†è¿”å›å€¼(dword)</li></ul><p>è¯·æ³¨æ„ï¼Œç”±äºä»»ä½•åŸºäºæ ˆçš„å‚æ•°éƒ½æ˜¯ç”±è°ƒç”¨å‡½æ•°å‹å…¥çš„ï¼Œå› æ­¤å®ƒä»¬å°†å‡ºç°åœ¨æ ˆä¸Šè°ƒç”¨æŒ‡ä»¤å‹å…¥çš„ <code>rip</code> å€¼ä¸‹æ–¹ã€‚å¦‚æœæ‚¨å°†è¢«è°ƒç”¨å‡½æ•°çš„æ ˆå¸§ï¼ˆè§ä¸‹æ–‡ï¼‰è§†ä¸ºåœ¨æ¨é€çš„ <code>rip</code> å¤„å¼€å§‹ï¼Œè¿™å¯èƒ½ä¼šæœ‰äº›ä»¤äººæƒŠè®¶ã€‚æ ˆå¸§é¦–å…ˆåŒ…æ‹¬å‡½æ•°éœ€è¦ä¿ç•™ï¼ˆè°ƒç”¨è€…ä¿ç•™ï¼‰çš„ä»»ä½•å¯„å­˜å™¨ï¼Œç„¶åæ˜¯ä»»ä½•åŸºäºå †æ ˆçš„å±€éƒ¨å˜é‡ã€‚</p><p>å¦è¯·æ³¨æ„ï¼Œå› ä¸ºå‡½æ•°åœ¨ rip ä¹‹å‰æ¨é€ä»»ä½•é¢å¤–çš„å‚æ•°ï¼Œæ‰€ä»¥è¢«è°ƒç”¨çš„å‡½æ•°ä¸å¯èƒ½å°†å®ƒä»¬å¼¹å‡ºã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„å‡½æ•°å°†ä»»ä½•å‚æ•°å‹å…¥å †æ ˆï¼Œå®ƒåº”è¯¥å°†å®ƒä»¬å¼¹å‡ºï¼Œæˆ–è€…åœ¨å‡½æ•°è¿”å›åé€‚å½“åœ°å¢åŠ  rsp ï¼Œä»¥ä¾¿ä½¿å †æ ˆä¿æŒç›¸åŒçš„çŠ¶æ€ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨æ‰§è¡Œè°ƒç”¨ä¹‹å‰ï¼Œæ ˆæŒ‡é’ˆå¿…é¡»å¯¹é½åˆ° 16 + 8 çš„å€æ•°ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æ­£åœ¨è°ƒç”¨å…·æœ‰ä»»ä½•åŸºäºæ ˆçš„å‚æ•°çš„å‡½æ•°ï¼Œåˆ™åº”è¯¥å°†è¿™äº›å‚æ•°çš„æ€»å¤§å°ç›¸åŠ ï¼Œç„¶åï¼Œå¦‚æœå¿…è¦æ—¶ï¼Œè°ƒæ•´ rspï¼ˆé€šè¿‡å‡æ³•ï¼‰ä»¥ä½¿å…¶å¯¹é½ã€‚</p><p>è¦æ±‚å †æ ˆå¯¹é½çš„åŸå› æ˜¯å®ƒå¯ä»¥ä½¿ç”¨æ›´æœ‰æ•ˆçš„å¯¹é½ç§»åŠ¨æŒ‡ä»¤ã€‚è¿™äº›å°†å€¼ç§»å…¥/ç§»å‡ºå‘é‡å¯„å­˜å™¨ xmm0,1,...ï¼Œä½†å®ƒä»¬è¦æ±‚å†…å­˜æ“ä½œæ•°çš„åœ°å€ä¸ 8 å­—èŠ‚çš„å€æ•°å¯¹é½ã€‚å°è¯•ä»æœªå¯¹é½çš„åœ°å€è¿›è¡Œå¯¹é½ç§»åŠ¨ä¼šè§¦å‘æ®µé”™è¯¯ã€‚ ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨æ²¡æœ‰é¦–å…ˆå¯¹é½å †æ ˆæŒ‡é’ˆçš„æƒ…å†µä¸‹è°ƒç”¨ C åº“å‡½æ•°ï¼Œåˆ™æ‚¨çš„ç¨‹åºå°†åœ¨è°ƒç”¨ç‚¹å‡ºç°æ®µé”™è¯¯ã€‚ï¼‰</p><h3 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼" aria-hidden="true">#</a> è¿”å›å€¼</h3><p>è¿”å›ç»“æœåº”æ”¾ç½®åœ¨ <code>rax</code> ä¸­ï¼Œå¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™åº”æ”¾ç½®åœ¨ <code>xmm0</code> ä¸­ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œ<code>rax</code> å’Œ <code>rdx</code> å¯ç”¨äºè¿”å›ä¸¤ä¸ªå€¼ï¼ˆC/C++ ä¸­ä¸æ”¯æŒï¼‰æˆ–å•ä¸ª 128 ä½å€¼ï¼Œå¦‚ <code>rdx:rax</code>ã€‚</p><p>è¾ƒå¤§çš„è¿”å›å€¼é€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼â€œè¿”å›â€ï¼šå°†æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆä½œä¸ºéšå¼ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼ˆå³ï¼Œåœ¨ rdi ä¸­ï¼Œå°†åˆ—è¡¨ä¸­çš„æ‰€æœ‰å‰©ä½™å‚æ•°å‘ä¸‹æ¨ï¼‰ï¼Œä¿®æ”¹å‡½æ•°å†…çš„å†…å­˜ï¼Œç„¶ååœ¨æ‹‰å…‹æ–¯ã€‚é€šå¸¸ï¼Œè°ƒç”¨å‡½æ•°ä¼šä¸ºå…¶å †æ ˆå¸§ä¸­çš„ç»“æ„åˆ†é…ç©ºé—´ï¼Œä½†è¿™å¯¹äºè¢«è°ƒç”¨å‡½æ•°æ¥è¯´å¹¶ä¸å®¹æ˜“è®¿é—®ï¼Œå› æ­¤éœ€è¦æŒ‡é’ˆå‚æ•°ã€‚</p><h3 id="æ ˆå¸§" tabindex="-1"><a class="header-anchor" href="#æ ˆå¸§" aria-hidden="true">#</a> æ ˆå¸§</h3><p>è°ƒç”¨å‡½æ•°æ—¶åˆ›å»ºçš„æ ˆç§°ä¸ºæ ˆå¸§ã€‚æ ˆå¸§ä¸­è‡³å°‘åŒ…æ‹¬è¿”å›åœ°å€ï¼ˆå³ <code>ret</code> æŒ‡ä»¤å°†è·³è½¬åˆ°çš„ <code>rip</code>ï¼‰ï¼Œä½†å¯èƒ½åŒ…æ‹¬å…¶ä»–ä¿¡æ¯ï¼š</p><ul><li>å‚æ•°ï¼Œå¦‚æœè¶…è¿‡ 6 ä¸ª</li><li>è¢«è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨çš„å€¼</li><li>å±€éƒ¨å˜é‡ï¼ˆå¦‚æœå¯„å­˜å™¨å¤ªå¤šè€Œæ— æ³•å®¹çº³ï¼‰</li></ul><p>è®¸å¤šå°å‡½æ•°åªéœ€è¦è¿”å›åœ°å€å³å¯ï¼›è¿™äº›å‡½æ•°æœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ ˆå¸§ï¼Œå¤§å°åˆšå¥½è¶³ä»¥å®¹çº³åœ°å€ï¼ˆå³ 8 ä¸ªå­—èŠ‚ï¼‰ã€‚</p><p>ä¼ ç»Ÿä¸Šï¼Œrbpï¼ˆåŸºæŒ‡é’ˆï¼‰å¯„å­˜å™¨ç”¨äºæŒ‡å‘ï¼ˆæŸç§ç¨‹åº¦ä¸Šï¼‰å‡½æ•°æ ˆå¸§çš„å¼€å¤´ï¼›å®ƒçš„å€¼æŒ‡å‘å‹å…¥çš„è¿”å›åœ°å€ä¸Šæ–¹çš„æ ˆå…ƒç´ ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ rbpï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨å‡½æ•°è°ƒç”¨ä¸­ä¿ç•™å®ƒï¼Œå› æ­¤ rbp æŒ‡å‘çš„å †æ ˆä¸Šçš„å€¼å®é™…ä¸Šæ˜¯è°ƒç”¨å‡½æ•°çš„ rbpã€‚å› æ­¤ï¼Œå †æ ˆçš„å¸ƒå±€å¦‚ä¸‹:</p><table><thead><tr><th>åœ°å€</th><th>å†…å®¹</th></tr></thead><tbody><tr><td></td><td>...</td></tr><tr><td></td><td>caller-saved registers...</td></tr><tr><td>rbp + n</td><td>...</td></tr><tr><td>rbp + 16</td><td>stack-based arguments</td></tr><tr><td>rbp + 8</td><td><code>rip</code></td></tr><tr><td>rbp</td><td>è°ƒç”¨è€…çš„<code>rbp</code></td></tr><tr><td>rbp - 8</td><td>callee saved regs</td></tr><tr><td>rbp-m</td><td>...</td></tr><tr><td>rsp</td><td>top of stack</td></tr><tr><td>...</td><td>red area</td></tr><tr><td>rsp-128</td><td></td></tr></tbody></table><h2 id="å‡½æ•°æ¨¡æ¿" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°æ¨¡æ¿" aria-hidden="true">#</a> å‡½æ•°æ¨¡æ¿</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œè¯¥å‡½æ•°ä¿ç•™è¢«è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨å¹¶ä½¿ç”¨ rbp æŒ‡å‘å…¶å †æ ˆå¸§çš„å¼€å¤´ï¼š</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>;; func_name(arguments...)
;; What the function does
;; 
;; Arguments:
;;   arg1 -- rdi
;;   arg2 -- si
;;   ... etc
;;   arg7 -- qword, stack [rbp + 16]
;; 
;; Return value: eax
;;
global func_name
func_name:

    ;; Preamble
    push rbp     ; Save calling function&#39;s rbp
    mov rbp, rsp ; rbp points to our stack frame

    push r12     ; Push any callee-saved registers you use

    ; If you need space for stack-based local variables, you can reserve it with
    ;   sub rsp, amount

    ; Realign rsp to 16*rsp + 8

    ;; Function body
    ...          

    ;; Epilogue

    ; Remove any alignment added

    ; If you reserved any space for stack-based local variables, you should 
    ; restore it with
    ;   add rsp, amount    

    pop r12      ; Restore callee-saved registers
    pop rbp      ; Restore caller&#39;s rbp
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸-c-å‡½æ•°äº’æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ä¸-c-å‡½æ•°äº’æ“ä½œ" aria-hidden="true">#</a> ä¸ C å‡½æ•°äº’æ“ä½œ</h3><p>ä¸Šé¢ç»™å‡ºçš„è§„åˆ™æè¿°äº† C å‡½æ•°ä½¿ç”¨çš„&quot;è°ƒâ€‹â€‹ç”¨çº¦å®š&quot;ã€‚ ï¼ˆC++ å‡½æ•°ä½¿ç”¨ç›¸åŒçš„è°ƒç”¨çº¦å®šï¼Œä½† C++ å‡½æ•°çš„åç§°ç»è¿‡ä¿®æ”¹ä»¥åŒ…å«å…¶å‚æ•°å’Œè¿”å›ç±»å‹ã€‚ï¼‰</p><p>è¿™æ„å‘³ç€é€šè¿‡ä½¿ç”¨ä¸Šè¿°è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥</p><ul><li>è°ƒç”¨ç”¨ C ç¼–å†™çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ C æ ‡å‡†åº“å‡½æ•°</li><li>ä» C/C++ ä»£ç è°ƒç”¨æ±‡ç¼–å‡½æ•°</li></ul><p>ä¸ºäº†è°ƒç”¨ C å‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»åšä¸‰ä»¶äº‹ï¼š</p><ul><li>å°†æˆ‘ä»¬ç¨‹åºçš„å…¥å£å†™ä¸º main è€Œä¸æ˜¯ _startï¼Œå£°æ˜ä¸ºå…¨å±€ã€‚åœ¨å‡½æ•°å…¥å£å¤„æ­£ç¡®è®¾ç½®å †æ ˆï¼Œåœ¨é€€å‡ºæ—¶å°†å…¶æ‹†é™¤ï¼Œå¹¶é€šè¿‡ rax è¿”å›ç¨‹åºçš„é€€å‡ºä»£ç ï¼ˆå³æ— éœ€ä½¿ç”¨ SYS_EXIT ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚</li></ul><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>section .data

msg:    db      &quot;Hello, world!&quot;, 0

; Note: no length, no 10 (newline) byte

section .text

extern puts
global main

main:

    ; Setup stack
    push rbp
    mov rbp, rsp

    ; Set registers to arguments. 
    mov rdi, msg
    call puts

    ; Cleanup stack, return 0
    pop rbp
    mov rax, 0
    ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>å ä½ç¬¦</th><th>æè¿°</th><th>å‚æ•°ç±»å‹</th></tr></thead><tbody><tr><td>%c</td><td>å•ä¸ªå­—ç¬¦</td><td>int</td></tr><tr><td>%s</td><td>ä»¥nullç»“å°¾çš„å­—ç¬¦ä¸²</td><td>char*</td></tr><tr><td>%d</td><td>æœ‰ç¬¦å·æ•´å‹å˜é‡</td><td>int</td></tr><tr><td>%ld</td><td>æœ‰ç¬¦å·æ•´å‹å˜é‡</td><td>long</td></tr><tr><td>%hd</td><td>æœ‰ç¬¦å·æ•´å‹å˜é‡</td><td>short</td></tr><tr><td>%hhd</td><td>æœ‰ç¬¦å·æ•´å‹å˜é‡</td><td>char</td></tr><tr><td>%u</td><td>æ— ç¬¦å·æ•´å‹å˜é‡</td><td>unsigned int</td></tr><tr><td>%lu</td><td></td><td></td></tr><tr><td>%f</td><td>æµ®ç‚¹æ•°</td><td>double</td></tr></tbody></table><p>ç”±äº <code>printf</code> æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ª<strong>å¯å˜å‚æ•°å‡½æ•°</strong>ï¼Œå®ƒä¸ºå…¶å‚æ•°çš„ä¼ é€’æ–¹å¼æ·»åŠ äº†ä¸€æ¡é¢å¤–çš„è§„åˆ™ï¼š</p><ul><li>å¦‚æœ <code>xmm</code> å¯„å­˜å™¨ä¸­ä¼ é€’äº†ä»»ä½•æµ®ç‚¹å‚æ•°ï¼Œåˆ™å°† <code>al</code> è®¾ç½®ä¸ºè¿™äº›å‚æ•°çš„æ•°é‡ã€‚</li></ul><p>printf çš„å¯¹åº”é¡¹æ˜¯ scanfï¼Œå®ƒé‡‡ç”¨ç±»ä¼¼çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œåªä¸è¿‡å®ƒæ ¹æ®ç»™å®šçš„æ ¼å¼ä» stdin è¯»å–è¾“å…¥ã€‚å…¶ä½™å‚æ•°å¿…é¡»æ˜¯æŒ‡å‘å°†å†™å…¥è¾“å…¥çš„å˜é‡çš„æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·åš:</p><div class="language-C line-numbers-mode" data-ext="C"><pre class="language-C"><code>int x, y, z;
scanf(&quot;%d %d %d&quot;, &amp;x, &amp;y, &amp;z);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å…¥ 1 2 3ï¼Œåˆ™å˜é‡ x å°†åŒ…å« 1ï¼Œy å°†åŒ…å« 2ï¼Œz å°†åŒ…å« 3ã€‚</p><p>å¯¹äº scanfï¼Œä½¿ç”¨æ­£ç¡®çš„æ ¼å¼è¯´æ˜ç¬¦è‡³å…³é‡è¦ï¼ä¾‹å¦‚ï¼Œå½“æ‚¨æ‰“ç®—è¯»å…¥ qword æ—¶ä½¿ç”¨ %d (dword) ä¼šå¯¼è‡´é—®é¢˜ï¼Œé€šå¸¸æ˜¯å› ä¸º scanf åªä¼šå†™å…¥ä½ä½ dwordï¼Œè€Œé«˜ 4 ä¸ªå­—èŠ‚ä¿æŒä¸å˜ã€‚</p><h2 id="é™„å½•" tabindex="-1"><a class="header-anchor" href="#é™„å½•" aria-hidden="true">#</a> é™„å½•</h2><h3 id="è¯¾ç¨‹èµ„æº" tabindex="-1"><a class="header-anchor" href="#è¯¾ç¨‹èµ„æº" aria-hidden="true">#</a> è¯¾ç¨‹èµ„æº</h3><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://staffwww.fullcoll.edu/aclifton/cs241/lecture-stack-c-functions.html" target="_blank" rel="noopener noreferrer">https://staffwww.fullcoll.edu/aclifton/cs241/lecture-stack-c-functions.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/posts/Program_language/Assembly_language/fullerton_CSci241/Lecture8-calling-c-functions.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 119160524@qq.com">zgjsxx</span><!--]--><!--]--></div></div></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Code Building</div><div class="copyright">Copyright Â© 2024 ç¨‹åºå‘˜å°x</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-13c30fd9.js" defer></script>
  </body>
</html>

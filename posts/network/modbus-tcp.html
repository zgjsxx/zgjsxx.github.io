<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/posts/network/modbus-tcp.html"><meta property="og:site_name" content="Code Building"><meta property="og:title" content="modbus-tcp"><meta property="og:description" content="modbus-tcp Modbus协议通过主站（客户端）和从站（服务器）之间的请求-应答机制来交换信息。主站-从站原理是一个用于通讯协议的模式，其中一个设备（主站）控制一个或多个其它设备（从站）。在标准的 Modbus 网络中，有 1个主站和最多31 个从站。 MODBUS报文解析 | MBAP Header | Function code | Data | | Header | PDU | MBAP header包含下面几个部分： Transaction ID Protocol ID Length UnitID FCode Data"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-11-09T07:05:30.000Z"><meta property="article:modified_time" content="2023-11-09T07:05:30.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"modbus-tcp","image":[""],"dateModified":"2023-11-09T07:05:30.000Z","author":[]}</script><title>modbus-tcp | Code Building</title><meta name="description" content="modbus-tcp Modbus协议通过主站（客户端）和从站（服务器）之间的请求-应答机制来交换信息。主站-从站原理是一个用于通讯协议的模式，其中一个设备（主站）控制一个或多个其它设备（从站）。在标准的 Modbus 网络中，有 1个主站和最多31 个从站。 MODBUS报文解析 | MBAP Header | Function code | Data | | Header | PDU | MBAP header包含下面几个部分： Transaction ID Protocol ID Length UnitID FCode Data">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-3dfb99ab.css" as="style"><link rel="stylesheet" href="/assets/style-3dfb99ab.css">
    <link rel="modulepreload" href="/assets/app-9ce5baef.js"><link rel="modulepreload" href="/assets/framework-9a29aaa0.js"><link rel="modulepreload" href="/assets/modbus-tcp.html-74355720.js"><link rel="modulepreload" href="/assets/modbus-tcp.html-4c8bad88.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Code Building"><!----><span class="site-name hide-in-pad">Code Building</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="程序员小x"><span class="font-icon icon iconfont icon-home" style=""></span>程序员小x<!----></a></div><div class="nav-item hide-in-mobile"><a href="/demo/" class="nav-link" aria-label="演示"><span class="font-icon icon iconfont icon-discover" style=""></span>演示<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博文"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>博文</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/network" class="nav-link active" aria-label="计算机网络"><span class="font-icon icon iconfont icon-edit" style=""></span>计算机网络<!----></a></li><li class="dropdown-item"><a href="/posts/Program_language/cpp" class="nav-link" aria-label="c++"><span class="font-icon icon iconfont icon-edit" style=""></span>c++<!----></a></li><li class="dropdown-item"><a href="/posts/design-pattern" class="nav-link" aria-label="设计模式"><span class="font-icon icon iconfont icon-edit" style=""></span>设计模式<!----></a></li><li class="dropdown-item"><a href="/posts/tool" class="nav-link" aria-label="工具"><span class="font-icon icon iconfont icon-edit" style=""></span>工具<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/compile" class="nav-link" aria-label="编译原理"><span class="font-icon icon iconfont icon-edit" style=""></span>编译原理<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/kernel/Linux-0.11" class="nav-link" aria-label="Linux-0.11详解"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux-0.11详解<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/application-dev" class="nav-link" aria-label="Linux应用层开发"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux应用层开发<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://meiriyiwen.com/" rel="noopener noreferrer" target="_blank" aria-label="每日一文" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>每日一文<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/posts/about/about.html" class="nav-link" aria-label="关于作者"><span class="font-icon icon iconfont icon-about" style=""></span>关于作者<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-info" style=""></span><span class="title">计算机网络</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/posts/network/http-introduction.html" class="nav-link sidebar-link sidebar-page" aria-label="http 协议"><!---->http 协议<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->modbus-tcp</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://zgjsxx.github.io" target="_blank" rel="noopener noreferrer">程序员小x</a></span><span property="author" content="程序员小x"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-11-09T07:05:30.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 7 分钟</span><meta property="timeRequired" content="PT7M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category0 clickable" role="navigation">network</span><meta property="articleSection" content="network"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#modbus报文解析" class="router-link-active router-link-exact-active toc-link level2">MODBUS报文解析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#常用功能码" class="router-link-active router-link-exact-active toc-link level2">常用功能码</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#功能码0x1-读线圈寄存器" class="router-link-active router-link-exact-active toc-link level3">功能码0x1：读线圈寄存器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#写单个线圈寄存器0x05" class="router-link-active router-link-exact-active toc-link level3">写单个线圈寄存器0x05：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#_0x0f-写多个线圈" class="router-link-active router-link-exact-active toc-link level3">0x0F：写多个线圈</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#_0x02-读离散量输入" class="router-link-active router-link-exact-active toc-link level3">0x02：读离散量输入</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#_0x04-读输入寄存器" class="router-link-active router-link-exact-active toc-link level3">0x04：读输入寄存器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#_0x03-读保持寄存器" class="router-link-active router-link-exact-active toc-link level3">0x03：读保持寄存器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#_0x06-写单个保持寄存器" class="router-link-active router-link-exact-active toc-link level3">0x06：写单个保持寄存器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/network/modbus-tcp.html#_0x10-写多个保持寄存器" class="router-link-active router-link-exact-active toc-link level3">0x10：写多个保持寄存器</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="modbus-tcp" tabindex="-1"><a class="header-anchor" href="#modbus-tcp" aria-hidden="true">#</a> modbus-tcp</h1><p>Modbus协议通过主站（客户端）和从站（服务器）之间的请求-应答机制来交换信息。主站-从站原理是一个用于通讯协议的模式，其中一个设备（主站）控制一个或多个其它设备（从站）。在标准的 Modbus 网络中，有 1个主站和最多31 个从站。</p><h2 id="modbus报文解析" tabindex="-1"><a class="header-anchor" href="#modbus报文解析" aria-hidden="true">#</a> MODBUS报文解析</h2><p>| MBAP Header | Function code | Data | | Header | PDU |</p><p>MBAP header包含下面几个部分：</p><ul><li>Transaction ID</li><li>Protocol ID</li><li>Length</li><li>UnitID</li><li>FCode</li><li>Data</li></ul><table><thead><tr><th>id</th><th>名称</th><th>长度</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>Transaction ID 事务处理标识</td><td>2字节</td><td>报文的序列号，一般每次通讯加1，用于区别不同的报文</td></tr><tr><td>2</td><td>Protocol ID 协议标识</td><td>2字节</td><td>00 00 代表modbus-Tcp</td></tr><tr><td>3</td><td>Length</td><td>2字节</td><td>Unit长度 + PDU的长度</td></tr><tr><td>4</td><td>UnitID</td><td>单元标识符</td><td>1</td></tr></tbody></table><p>|00 01| 00 00|00 06| 01 |</p><p>上述序列代表：事务标识为1，协议是modbus-tcp协议，数据长度是：6，从站号是1。</p><p>需要注意的是MODBUS协议是一个<strong>大端</strong>的协议，前两个byte 00 01代表0x1 , 因此Transaction ID=1。而长度字段00 06代表0x6， 即UnitID和PDU的长度总和为6。</p><p>modbus的操作对象有四种：线圈、离散输入、输入寄存器、保持寄存器。</p><p>功能码：</p><table><thead><tr><th>功能码</th><th>功能</th></tr></thead><tbody><tr><td>0x01</td><td>读单个或者多个线圈</td></tr><tr><td>0x05</td><td>写多个线圈</td></tr><tr><td>0x02</td><td>读离散量输入</td></tr><tr><td>0x04</td><td>读输入寄存器</td></tr><tr><td>0x03</td><td>读保持寄存器</td></tr><tr><td>0x06</td><td>写单个保持寄存器</td></tr><tr><td>0x10</td><td>写多个保持寄存器</td></tr></tbody></table><h2 id="常用功能码" tabindex="-1"><a class="header-anchor" href="#常用功能码" aria-hidden="true">#</a> 常用功能码</h2><h3 id="功能码0x1-读线圈寄存器" tabindex="-1"><a class="header-anchor" href="#功能码0x1-读线圈寄存器" aria-hidden="true">#</a> 功能码0x1：读线圈寄存器</h3><p>每个线圈寄存器可以存储一个bit的信息， 功能码0x01就是用于读取slave中线圈寄存器的状态，可以是<strong>单个线圈寄存器</strong>，也可以是<strong>多个连续的线圈寄存器</strong>。</p><p><strong>发送报文</strong></p><p>发送报文由下面几个部分组成，总共12字节：</p><p>MBAP header(7字节) + 功能码(1字节) + 线圈寄存器起始地址的高位（1字节） + 线圈寄存器起始地址的低位（1字节） + 线圈寄存器数量的高位（1字节） + 线圈寄存器数量的低位（1字节）</p><p>下面是一个用Modbus-Poll和Modbus-Slave测试的实际的例子，其含义是读取线圈寄存器的起始地址是0x0， 读取数量为 0x0a（十进制10）个。</p><figure><img src="https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/network/modbus-tcp/modbus-0x1-request.png" alt="0x1-request" tabindex="0" loading="lazy"><figcaption>0x1-request</figcaption></figure><table><thead><tr><th>MBAP header</th><th>功能码</th><th>起始地址高字节</th><th>起始地址低字节</th><th>寄存器数量的高位</th><th>寄存器数量的低位</th></tr></thead><tbody><tr><td>01 66 00 00 00 06 01</td><td>01</td><td>00</td><td>00</td><td>00</td><td>0a</td></tr></tbody></table><p>其中：</p><p>TransanctionID = 358, Length = 6。</p><p>功能码为0x1，代表读取线圈寄存器。</p><p>读取的线圈寄存器的起始地址为0。</p><p>读取的线圈寄存器的数量为0xa(十进制10)个。</p><p><strong>响应报文</strong></p><p>响应报文的长度不是固定的，长度和用户请求的数据长度有关，由下面几个部分组成：</p><p>MBAP header(7字节) + 功能码(1字节) + 线圈寄存器的值</p><p>下面是一个实际的响应报文的内容:</p><figure><img src="https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/network/modbus-tcp/modbus-0x1-response.png" alt="0x1-request" tabindex="0" loading="lazy"><figcaption>0x1-request</figcaption></figure><table><thead><tr><th>MBAP header</th><th>功能码</th><th>字节数</th><th>请求的数据1</th><th>请求的数据2</th></tr></thead><tbody><tr><td>01 66 00 00 00 05 01</td><td>01</td><td>02</td><td>21</td><td>02</td></tr></tbody></table><p>返回的第一个字节21，转化为二进制为00100001， 其中bit0代表01寄存器，bit7代表07寄存器。</p><table><thead><tr><th>0x7</th><th>0x6</th><th>0x5</th><th>0x4</th><th>0x3</th><th>0x2</th><th>0x1</th><th>0x0</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr></tbody></table><p>返回的第二个字节02，转化为二进制为00000010， 其中bit0代表08寄存器，bit1代表09寄存器。</p><table><thead><tr><th>0x9</th><th>0x8</th></tr></thead><tbody><tr><td>1</td><td>0</td></tr></tbody></table><h3 id="写单个线圈寄存器0x05" tabindex="-1"><a class="header-anchor" href="#写单个线圈寄存器0x05" aria-hidden="true">#</a> 写单个线圈寄存器0x05：</h3><p>将从站中的一个输出写成ON或OFF，0xFF00请求输出为ON,0x000请求输出为OFF</p><p>请求：MBAP 功能码 输出地址H 输出地址L 输出值H 输出值L（共12字节） 响应：MBAP 功能码 输出地址H 输出地址L 输出值H 输出值L（共12字节） 如：将地址为0x0003的线圈设为ON 00 01 00 00 00 06 01 | 05 00 03 FF 00 回：写入成功 00 01 00 00 00 06 01 |05 00 03 FF 00</p><h3 id="_0x0f-写多个线圈" tabindex="-1"><a class="header-anchor" href="#_0x0f-写多个线圈" aria-hidden="true">#</a> 0x0F：写多个线圈</h3><p>将一个从站中的一个线圈序列的每个线圈都强制为ON或OFF，数据域中置1的位请求相应输出位ON，置0的位请求响应输出为OFF</p><p>请求：MBAP 功能码 起始地址H 起始地址L 输出数量H 输出数量L 字节长度 输出值H 输出值L 响应：MBAP 功能码 起始地址H 起始地址L 输出数量H 输出数量L</p><h3 id="_0x02-读离散量输入" tabindex="-1"><a class="header-anchor" href="#_0x02-读离散量输入" aria-hidden="true">#</a> 0x02：读离散量输入</h3><p>从一个从站中读1~2000个连续的离散量输入状态</p><p>请求：MBAP 功能码 起始地址H 起始地址L 数量H 数量L（共12字节） 响应：MBAP 功能码 数据长度 数据（长度：9+ceil（数量/8）） 如：从地址0x0000开始读0x0012个离散量输入 00 01 00 00 00 06 01 02 00 00 00 12 回：数据长度为0x03个字节，数据为0x01 04 00，表示第一个离散量输入和第11个离散量输入为ON，其余为OFF 00 01 00 00 00 06 01 02 03 01 04 00</p><h3 id="_0x04-读输入寄存器" tabindex="-1"><a class="header-anchor" href="#_0x04-读输入寄存器" aria-hidden="true">#</a> 0x04：读输入寄存器</h3><p>从一个远程设备中读1~2000个连续输入寄存器</p><p>请求：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L（共12字节） 响应：MBAP 功能码 数据长度 寄存器数据(长度：9+寄存器数量×2) 如：读起始地址为0x0002，数量为0x0005的寄存器数据 00 01 00 00 00 06 01 04 00 02 00 05 回：数据长度为0x0A，第一个寄存器的数据为0x0c，其余为0x00 00 01 00 00 00 0D 01 04 0A 00 0C 00 00 00 00 00 00 00 00</p><h3 id="_0x03-读保持寄存器" tabindex="-1"><a class="header-anchor" href="#_0x03-读保持寄存器" aria-hidden="true">#</a> 0x03：读保持寄存器</h3><p>从远程设备中读保持寄存器连续块的内容</p><p>请求：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L（共12字节） 响应：MBAP 功能码 数据长度 寄存器数据(长度：9+寄存器数量×2) 如：起始地址是0x0000，寄存器数量是 0x0003 00 01 00 00 00 06 01 03 00 00 00 03 回：数据长度为0x06，第一个寄存器的数据为0x21，其余为0x00 00 01 00 00 00 09 01 03 06 00 21 00 00 00 00</p><h3 id="_0x06-写单个保持寄存器" tabindex="-1"><a class="header-anchor" href="#_0x06-写单个保持寄存器" aria-hidden="true">#</a> 0x06：写单个保持寄存器</h3><p>在一个远程设备中写一个保持寄存器</p><p>请求：MBAP 功能码 寄存器地址H 寄存器地址L 寄存器值H 寄存器值L（共12字节） 响应：MBAP 功能码 寄存器地址H 寄存器地址L 寄存器值H 寄存器值L（共12字节） 如：向地址是0x0000的寄存器写入数据0x000A 00 01 00 00 00 06 01 06 00 00 00 0A 回：写入成功 00 01 00 00 00 06 01 06 00 00 00 0A</p><h3 id="_0x10-写多个保持寄存器" tabindex="-1"><a class="header-anchor" href="#_0x10-写多个保持寄存器" aria-hidden="true">#</a> 0x10：写多个保持寄存器</h3><p>在一个远程设备中写连续寄存器块（1~123个寄存器）</p><p>请求：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L 字节长度 寄存器值（13+寄存器数量×2） 响应：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L（共12字节） 如：向起始地址为0x0000，数量为0x0001的寄存器写入数据，数据长度为0x02，数据为0x000F 00 01 00 00 00 09 01 10 00 00 00 01 02 00 0F 回：写入成功 00 01 00 00 00 06 01 10 00 00 00 01</p><p>实现代码</p><p><a href="https://github.com/fz-lyu/modbuspp" target="_blank" rel="noopener noreferrer">https://github.com/fz-lyu/modbuspp<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>调试工具</p><p>modbus poll： modbus客户端工具(主站)</p><p>modbus slave: modbus服务端工具(从站)</p><p>参考文章 <a href="https://blog.csdn.net/qq_36958104/article/details/124193794" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_36958104/article/details/124193794<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/posts/network/modbus-tcp.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 119160524@qq.com">zgjsxx</span><!--]--><!--]--></div></div></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Code Building</div><div class="copyright">Copyright © 2023 程序员小x</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-9ce5baef.js" defer></script>
  </body>
</html>

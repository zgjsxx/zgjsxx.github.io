<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html"><meta property="og:site_name" content="Code Building"><meta property="og:title" content="Linux-0.11 boot目录bootsect.s详解"><meta property="og:description" content="Linux-0.11 boot目录bootsect.s详解 模块简介 过程详解 step1：搬运bootsect.s代码到0x9000:0x0000处 step2：加载setup.s代码到0x9000:0x200处 step3：加载system模块到0x1000:0x0000处 参考文章"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-01T02:16:14.000Z"><meta property="article:tag" content="Linux-0.11代码解读系列"><meta property="article:modified_time" content="2024-04-01T02:16:14.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Linux-0.11 boot目录bootsect.s详解","image":[""],"dateModified":"2024-04-01T02:16:14.000Z","author":[]}</script><title>Linux-0.11 boot目录bootsect.s详解 | Code Building</title><meta name="description" content="Linux-0.11 boot目录bootsect.s详解 模块简介 过程详解 step1：搬运bootsect.s代码到0x9000:0x0000处 step2：加载setup.s代码到0x9000:0x200处 step3：加载system模块到0x1000:0x0000处 参考文章">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-646e803e.css" as="style"><link rel="stylesheet" href="/assets/style-646e803e.css">
    <link rel="modulepreload" href="/assets/app-c197ebf9.js"><link rel="modulepreload" href="/assets/framework-9a29aaa0.js"><link rel="modulepreload" href="/assets/Linux-0.11-boot-bootsect.html-90cdb12a.js"><link rel="modulepreload" href="/assets/Linux-0.11-boot-bootsect.html-0185afc8.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Code Building"><!----><span class="site-name hide-in-pad">Code Building</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="程序员小x"><span class="font-icon icon iconfont icon-home" style=""></span>程序员小x<!----></a></div><div class="nav-item hide-in-mobile"><a href="/demo/" class="nav-link" aria-label="演示"><span class="font-icon icon iconfont icon-discover" style=""></span>演示<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博文"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>博文</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/network" class="nav-link" aria-label="计算机网络"><span class="font-icon icon iconfont icon-edit" style=""></span>计算机网络<!----></a></li><li class="dropdown-item"><a href="/posts/Program_language/cpp" class="nav-link" aria-label="c++"><span class="font-icon icon iconfont icon-edit" style=""></span>c++<!----></a></li><li class="dropdown-item"><a href="/posts/design-pattern" class="nav-link" aria-label="设计模式"><span class="font-icon icon iconfont icon-edit" style=""></span>设计模式<!----></a></li><li class="dropdown-item"><a href="/posts/tool" class="nav-link" aria-label="工具"><span class="font-icon icon iconfont icon-edit" style=""></span>工具<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/compile" class="nav-link" aria-label="编译原理"><span class="font-icon icon iconfont icon-edit" style=""></span>编译原理<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/kernel/Linux-0.11" class="nav-link active" aria-label="Linux-0.11详解"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux-0.11详解<!----></a></li><li class="dropdown-item"><a href="/posts/Linux/application-dev" class="nav-link" aria-label="Linux应用层开发"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux应用层开发<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://meiriyiwen.com/" rel="noopener noreferrer" target="_blank" aria-label="每日一文" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>每日一文<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/posts/about/about.html" class="nav-link" aria-label="关于作者"><span class="font-icon icon iconfont icon-about" style=""></span>关于作者<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="font-icon icon iconfont icon-info" style=""></span><span class="title">Linux-0.11详解</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-assemble-language.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11中的汇编"><!---->Linux-0.11中的汇编<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Linux-0.11 boot目录bootsect.s详解"><!---->Linux-0.11 boot目录bootsect.s详解<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#模块简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模块简介"><!---->模块简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#过程详解" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="过程详解"><!---->过程详解<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#step1-搬运bootsect-s代码到0x9000-0x0000处" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="step1：搬运bootsect.s代码到0x9000:0x0000处"><!---->step1：搬运bootsect.s代码到0x9000:0x0000处<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#step2-加载setup-s代码到0x9000-0x200处" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="step2：加载setup.s代码到0x9000:0x200处"><!---->step2：加载setup.s代码到0x9000:0x200处<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#step3-加载system模块到0x1000-0x0000处" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="step3：加载system模块到0x1000:0x0000处"><!---->step3：加载system模块到0x1000:0x0000处<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#参考文章" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="参考文章"><!---->参考文章<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-setup.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 boot目录setup.s详解"><!---->Linux-0.11 boot目录setup.s详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-head.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 boot目录head.s详解"><!---->Linux-0.11 boot目录head.s详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-bitmap.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统bitmap.c详解"><!---->Linux-0.11 文件系统bitmap.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-block_dev.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统block_dev.c详解"><!---->Linux-0.11 文件系统block_dev.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-buffer.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统buffer.c详解"><!---->Linux-0.11 文件系统buffer.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-char_dev.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统char_dev.c详解"><!---->Linux-0.11 文件系统char_dev.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-exec.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统exec.c详解"><!---->Linux-0.11 文件系统exec.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-fcntl.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统fcntl.c详解"><!---->Linux-0.11 文件系统fcntl.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-file_dev.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统file_dev.c详解"><!---->Linux-0.11 文件系统file_dev.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-inode.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统inode.c详解"><!---->Linux-0.11 文件系统inode.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-ioctl.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统ioctl.c详解"><!---->Linux-0.11 文件系统ioctl.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-namei.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统namei.c详解"><!---->Linux-0.11 文件系统namei.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-open.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统open.c详解"><!---->Linux-0.11 文件系统open.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-pipe.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统pipe.c详解"><!---->Linux-0.11 文件系统pipe.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-read_write.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统read_write.c详解"><!---->Linux-0.11 文件系统read_write.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-stat.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统stat.c详解"><!---->Linux-0.11 文件系统stat.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-super.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统super.c详解"><!---->Linux-0.11 文件系统super.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-fs-truncate.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 文件系统truncate.c详解"><!---->Linux-0.11 文件系统truncate.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-init-main.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 入口函数main.c详解"><!---->Linux-0.11 入口函数main.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-asm.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录进程管理asm.s详解"><!---->Linux-0.11 kernel目录进程管理asm.s详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-exit.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录exit.c详解"><!---->Linux-0.11 kernel目录exit.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-fork.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录fork.c详解"><!---->Linux-0.11 kernel目录fork.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-ll-rw-blk.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录ll_rw_blk.c详解"><!---->Linux-0.11 kernel目录ll_rw_blk.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-mktime-printk-panic.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录mktime.c/printk.c/panic.c详解"><!---->Linux-0.11 kernel目录mktime.c/printk.c/panic.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-hd.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录hd.c详解"><!---->Linux-0.11 kernel目录hd.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-sched.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录进程管理sched.c详解"><!---->Linux-0.11 kernel目录进程管理sched.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-signal.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录进程管理signal.c详解"><!---->Linux-0.11 kernel目录进程管理signal.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-sys.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录进程管理sys.c详解"><!---->Linux-0.11 kernel目录进程管理sys.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-system_call.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录进程管理system_call.s详解"><!---->Linux-0.11 kernel目录进程管理system_call.s详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-trap.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录进程管理trap.c详解"><!---->Linux-0.11 kernel目录进程管理trap.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-tty_ioctl.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录tty_ioctl.c详解"><!---->Linux-0.11 kernel目录tty_ioctl.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-kernel-tty-io.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 kernel目录tty_io.c详解"><!---->Linux-0.11 kernel目录tty_io.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-mm-memory.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 memory.c详解"><!---->Linux-0.11 memory.c详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-mm-page.html" class="nav-link sidebar-link sidebar-page" aria-label="Linux-0.11 page.s详解"><!---->Linux-0.11 page.s详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Linux-0.11 boot目录bootsect.s详解</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://zgjsxx.github.io" target="_blank" rel="noopener noreferrer">程序员小x</a></span><span property="author" content="程序员小x"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-05T09:09:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 14 分钟</span><meta property="timeRequired" content="PT14M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category0 clickable" role="navigation">Linux</span><meta property="articleSection" content="Linux"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag2 clickable" role="navigation">Linux-0.11代码解读系列</span><meta property="keywords" content="Linux-0.11代码解读系列"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#模块简介" class="router-link-active router-link-exact-active toc-link level2">模块简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#过程详解" class="router-link-active router-link-exact-active toc-link level2">过程详解</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#step1-搬运bootsect-s代码到0x9000-0x0000处" class="router-link-active router-link-exact-active toc-link level3">step1：搬运bootsect.s代码到0x9000:0x0000处</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#step2-加载setup-s代码到0x9000-0x200处" class="router-link-active router-link-exact-active toc-link level3">step2：加载setup.s代码到0x9000:0x200处</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#step3-加载system模块到0x1000-0x0000处" class="router-link-active router-link-exact-active toc-link level3">step3：加载system模块到0x1000:0x0000处</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.html#参考文章" class="router-link-active router-link-exact-active toc-link level2">参考文章</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><ul><li><a href="#linux-011-boot%E7%9B%AE%E5%BD%95bootsects%E8%AF%A6%E8%A7%A3">Linux-0.11 boot目录bootsect.s详解</a><ul><li><a href="#%E6%A8%A1%E5%9D%97%E7%AE%80%E4%BB%8B">模块简介</a></li><li><a href="#%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3">过程详解</a><ul><li><a href="#step1%E6%90%AC%E8%BF%90bootsects%E4%BB%A3%E7%A0%81%E5%88%B00x90000x0000%E5%A4%84">step1：搬运bootsect.s代码到<code>0x9000:0x0000</code>处</a></li><li><a href="#step2%E5%8A%A0%E8%BD%BDsetups%E4%BB%A3%E7%A0%81%E5%88%B00x90000x200%E5%A4%84">step2：加载setup.s代码到<code>0x9000:0x200</code>处</a></li><li><a href="#step3%E5%8A%A0%E8%BD%BDsystem%E6%A8%A1%E5%9D%97%E5%88%B00x10000x0000%E5%A4%84">step3：加载system模块到<code>0x1000:0x0000</code>处</a></li></ul></li><li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0">参考文章</a></li></ul></li></ul><h1 id="linux-0-11-boot目录bootsect-s详解" tabindex="-1"><a class="header-anchor" href="#linux-0-11-boot目录bootsect-s详解" aria-hidden="true">#</a> Linux-0.11 boot目录bootsect.s详解</h1><h2 id="模块简介" tabindex="-1"><a class="header-anchor" href="#模块简介" aria-hidden="true">#</a> 模块简介</h2><p>bootsect.s是磁盘启动的引导程序，其概括起来就是代码的搬运工，将代码搬到合适的位置。下图是对搬运过程的概括，可以有个印象，后面将详细讲解。</p><figure><img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/kernel/Linux-0.11/Linux-0.11-boot/bootsect/bootsect_boot.png" alt="启动中内存分布变化" tabindex="0" loading="lazy"><figcaption>启动中内存分布变化</figcaption></figure><p>bootsect.s主要做了如下的三件事:</p><ul><li>搬运bootsect.s代码到0x9000:0x0000处</li><li>加载setup.s代码到0x9000:0x200处</li><li>加载system模块到0x1000:0x0000处</li></ul><h2 id="过程详解" tabindex="-1"><a class="header-anchor" href="#过程详解" aria-hidden="true">#</a> 过程详解</h2><h3 id="step1-搬运bootsect-s代码到0x9000-0x0000处" tabindex="-1"><a class="header-anchor" href="#step1-搬运bootsect-s代码到0x9000-0x0000处" aria-hidden="true">#</a> step1：搬运bootsect.s代码到<code>0x9000:0x0000</code>处</h3><p>下面是bootsect.s中开头1-50行。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>!
! SYS_SIZE is the number of clicks (16 bytes) to be loaded.
! 0x3000 is 0x30000 bytes = 196kB, more than enough for current
! versions of linux
!
SYSSIZE = 0x3000
!
!	bootsect.s		(C) 1991 Linus Torvalds
!
! bootsect.s is loaded at 0x7c00 by the bios-startup routines, and moves
! iself out of the way to address 0x90000, and jumps there.
!
! It then loads &#39;setup&#39; directly after itself (0x90200), and the system
! at 0x10000, using BIOS interrupts. 
!
! NOTE! currently system is at most 8*65536 bytes long. This should be no
! problem, even in the future. I want to keep it simple. This 512 kB
! kernel size should be enough, especially as this doesn&#39;t contain the
! buffer cache as in minix
!
! The loader has been made as simple as possible, and continuos
! read errors will result in a unbreakable loop. Reboot by hand. It
! loads pretty fast by getting whole sectors at a time whenever possible.

.globl begtext, begdata, begbss, endtext, enddata, endbss
.text
begtext:
.data
begdata:
.bss
begbss:
.text

SETUPLEN = 4				! nr of setup-sectors
BOOTSEG  = 0x07c0			! original address of boot-sector
INITSEG  = 0x9000			! we move boot here - out of the way
SETUPSEG = 0x9020			! setup starts here
SYSSEG   = 0x1000			! system loaded at 0x10000 (65536).
ENDSEG   = SYSSEG + SYSSIZE		! where to stop loading

! ROOT_DEV:	0x000 - same type of floppy as boot.
!		0x301 - first partition on first drive etc
ROOT_DEV = 0x306

entry _start
_start:
	mov	ax,#BOOTSEG
	mov	ds,ax
	mov	ax,#INITSEG
	mov	es,ax
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中最关键的是下面这几行：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov	ax,#BOOTSEG 
	mov	ds,ax
	mov	ax,#INITSEG
	mov	es,ax
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里首先将<code>ax</code>寄存器设置为<code>0x07c0</code>， 接着将<code>ax</code>寄存器的值拷贝给<code>ds</code>，即<code>ds</code>目前为<code>0x07c0</code>。</p><p>接下来将<code>ax</code>寄存器设置为<code>0x9000</code>， 接着将<code>ax</code>寄存器的值拷贝给<code>es</code>，即<code>es</code>目前为<code>0x9000</code>。</p><p>下面是bootsect.s中的51-55行：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov	cx,#256 #设置移动计数值256字
	sub	si,si   #源地址	ds:si = 0x07C0:0x0000
	sub	di,di   #目标地址 es:di = 0x9000:0x0000
	rep         #重复执行并递减cx的值
	movw        #从内存[si]处移动cx个字到[di]处			
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里首先将<code>cx</code>的值设置为<code>256</code>。</p><p>接下来<code>sub</code>指令后跟了两个相同的<code>si</code>寄存器，这其实会将寄存器<code>si</code>设置为0。<code>sub di,di</code>同理将<code>di</code>设置为0。</p><p>接下来使用<code>rep</code>前缀和<code>movsw</code>指令。</p><p>根据Intel手册，<code>movsw</code>的作用是从<code>DS:(E)SI</code>拷贝一个字到<code>ES:（E)DI</code>。<code>movsw</code>操作之后会对<code>si</code>和<code>si</code>进行递增或者递减，递增还是递减由<code>EFLAGS</code>寄存器中的方向位(DF: direction flag)来决定， DF=0，则进行递增， DF=1，则进行递减。</p><p>因此<code>rep movsw</code>的实际作用是从<code>ds:si</code>拷贝256个字(512字节)到<code>es:si</code>处。</p><p>接下来是bootsect.s的第56行，使用<code>jmpi</code>指令进行跳转。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	jmpi	go,INITSEG
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>jmpi</code>是段间跳转指令，<code>jmpi</code>的格式是<code>jmpi 段内偏移， 段选择子</code>。</p><p>这句指令使得程序跳转到<code>0x9000</code> 偏移量为<code>go</code>处的代码执行。执行完之后<code>cs</code>寄存器的值将等于<code>0x9000</code>。</p><p>下面是bootsect.s的第57-62行。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>go:	mov	ax,cs  #将ds，es，ss都设置成移动后代码所在的段处(0x9000)
	mov	ds,ax
	mov	es,ax
	mov	ss,ax
	mov	sp,#0xFF00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>cs</code>寄存器的值为<code>0x9000</code>。接下来的操作就是将<code>ds</code>，<code>es</code>，<code>ss</code>都赋值为<code>0x9000</code>。同时将<code>sp</code>设置为<code>0xFF00</code>。</p><h3 id="step2-加载setup-s代码到0x9000-0x200处" tabindex="-1"><a class="header-anchor" href="#step2-加载setup-s代码到0x9000-0x200处" aria-hidden="true">#</a> step2：加载setup.s代码到<code>0x9000:0x200</code>处</h3><p>接下来这一部分用于加载setup.s的代码到<code>0x9000:0x200</code>处。</p><p>下面这里是bootsect.s的67-77行。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>load_setup:
	mov	dx,#0x0000		! drive 0, head 0
	mov	cx,#0x0002		! sector 2, track 0
	mov	bx,#0x0200		! address = 512, in INITSEG
	mov	ax,#0x0200+SETUPLEN	! service 2, nr of sectors
	int	0x13			! read it
	jnc	ok_load_setup		! ok - continue
	mov	dx,#0x0000
	mov	ax,#0x0000		! reset the diskette
	int	0x13
	j	load_setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里利用了BIOS的<code>0x13</code>号中断，<code>0x13</code>中断和磁盘操作相关，这里使用了2号功能码。</p><p>0x13中断的2号功能的各项参数含义如下：</p><ul><li>AH = 02h</li><li>AL = 要读取多少扇区，非0的数值</li><li>CH = 柱面的低8位</li><li>CL = CL[5：0]表示起始扇区，CL[7：6]是柱面的高2位</li><li>DH = 磁头号</li><li>DL = 驱动器号</li><li>ES:BX = 数据缓冲区的位置</li></ul><p>返回值:</p><ul><li>当出错时CF被设置。</li><li>成功操作时，CF被清楚。</li></ul><p><code>ax = 0x0204</code>， 因此<code>ah=0x02</code>, <code>al=0x04</code>,代表这里进行的操作是都磁盘到内存，且要读取4个扇区。 <code>bx = 0x200</code>， 因此从磁盘中读取的数据将拷贝到<code>0x9000:0x200</code>处 <code>cx = 0x0002</code>, <code>cx[5:0] = 0x2</code>，表示起始扇区为2，<code>{cx[7:6], cx[15:8]} = 0x0</code>, 代表柱面为0。 <code>dx = 0x0000</code>， <code>dh = 0x0</code>, 磁头号为0， <code>dl = 0x0</code>, 驱动器号为0。</p><p>关于<code>0x13</code>中断的更多详细功能，可以参考<a href="http://www.ctyme.com/intr/int-13.htm" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>如果读取成功则执行<code>ok_load_setup</code>。 这里使用的是<code>jnc</code>跳转指令，它会根据CF的状态决定是否跳转。</p><p>如果不成功，则对驱动器进行复位，再次读取。复位操作仍然使用的是<code>0x13</code>中断，操作码为0。</p><ul><li>AH = 00h</li><li>DL = 驱动器号</li></ul><p>接下来是bootsect.s的79-90行。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>ok_load_setup:

! Get disk drive parameters, specifically nr of sectors/track

	mov	dl,#0x00
	mov	ax,#0x0800		! AH=8 is get drive parameters
	int	0x13
	mov	ch,#0x00
	seg cs
	mov	sectors,cx
	mov	ax,#INITSEG
	mov	es,ax
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里是使用<code>0x13</code>中断的8号功能码去获取一些磁盘驱动器的参数。</p><p>入参：</p><ul><li>ah：功能码，08h代表去获取驱动器的参数。</li><li>dl：为驱动器号。</li></ul><p>返回信息：</p><ul><li>CF：如果出错则CF置为1，如果成功则CF=0。如果出错，ah=状态码</li><li>ah = 0， al = 0</li><li>bl：驱动器的类型(AT/PS2)</li><li>ch：最大柱面号的低8位</li><li>cl: cl[5:0]代表每磁道最大扇区数， cl[7：6]代表最大柱面号高2位</li><li>dh:最大磁头数</li><li>dl:驱动器数量</li><li>es:di：软驱磁盘参数表</li></ul><p>在调用完0x13中断获取完磁盘参数后，首先对<code>ch</code>进行置零，因为<code>ch</code>中存放的是最大柱面，而我们下面要去获取扇区数，因此避免其干扰。</p><p>这下面使用<code>mov sectors,cx</code>将最大扇区数存在了sectors中。</p><p>最后由于中断返回值修改了<code>es</code>，因此需要进行恢复。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>mov	ax,#INITSEG
mov	es,ax
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是bootsect.s的第92-102行，主要使用BIOS中断<code>0x10</code>向终端中打印信息。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>! Print some inane message

	mov	ah,#0x03		! read cursor pos
	xor	bh,bh
	int	0x10
	
	mov	cx,#24
	mov	bx,#0x0007		! page 0, attribute 7 (normal)
	mov	bp,#msg1
	mov	ax,#0x1301		! write string, move cursor
	int	0x10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>0x10</code>中断号有多个功能,具体含义如下：</p><ul><li><p>1.读光标位置，<code>ah=0x03</code></p><p>输入：</p><ul><li>bh = 页号</li></ul><p>输出：</p><ul><li>ch = 扫描开始线</li><li>cl = 扫描结束线</li><li>dh = 行号</li><li>dl = 列号</li></ul></li><li><p>2.打印字符串：<code>ah=0x013</code></p><p>输入：</p><ul><li>al = 放置光标的方式和规定属性</li><li>es:bp 字符串位置</li><li>cx = 显示的字符串字符数</li><li>bh = 显示页面号</li><li>bl = 字符属性</li><li>dh = 行号</li><li>dl = 列号</li></ul></li></ul><p>首先读取了目前光标所在的位置，存储在了<code>dx</code>中。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov	ah,#0x03		! read cursor pos
	xor	bh,bh
	int	0x10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着指定了要显示的字符串的长度为24， 页面号为0，字符属性为7，要显示的字符位置是<code>0x9000:msg</code>, 即<code>\r\nLoading system ...\r\n\r\n</code>,放置光标的方式和规定属性为0x1。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov	cx,#24
	mov	bx,#0x0007		! page 0, attribute 7 (normal)
	mov	bp,#msg1
	mov	ax,#0x1301		! write string, move cursor
	int	0x10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="step3-加载system模块到0x1000-0x0000处" tabindex="-1"><a class="header-anchor" href="#step3-加载system模块到0x1000-0x0000处" aria-hidden="true">#</a> step3：加载system模块到<code>0x1000:0x0000</code>处</h3><p>接下来，要继续读system模块到内存中。</p><p>下面是bootsect.s的104-110行：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>! ok, we&#39;ve written the message, now
! we want to load the system (at 0x10000)

	mov	ax,#SYSSEG
	mov	es,ax		! segment of 0x010000
	call	read_it
	call	kill_motor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里实际会设置<code>ax=0x1000</code>, <code>es = 0x1000</code>，进而会调用<code>read_it</code>方法，稍后我们会详细理解<code>read_it</code>方法，这里我们先有个概念，<code>read_it</code>实际上作用就是将system模块存放在<code>0x1000:0x0000</code>处。</p><p><code>read_it</code>位于bootsect.s的第151行。</p><p>首先看151-155行。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>read_it:
	mov ax,es
	test ax,#0x0fff
die:	jne die			! es must be at 64kB boundary
	xor bx,bx		! bx is starting address within segment
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>test</code>指令执行AND运算，当AND运算的结果为零时，<code>test</code>设置零标志<code>ZF=1</code>。</p><p>而这里<code>0x1000 &amp; 0x0fff = 0x0000</code>,因此<code>ZF</code>会被设置。<code>jne</code>跳转的条件是<code>ZF == 0</code>，因此不会进行跳转。这里的作用主要是用来检查<code>es</code>的值要在````64KB```的边界处。</p><p>除此以外<code>xor bx，bx</code>将<code>bx</code>的寄存器设置为0。</p><p>接下来是第156-160行</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>rp_read:
	mov ax,es
	cmp ax,#ENDSEG		! have we loaded all yet?
	jb ok1_read
	ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>rp_read</code>的实际是逐磁道读取磁盘中system模块的过程。如下图所示共两个磁道，两个磁头，每磁道八个扇区，读取顺序如下所示，首先读取0磁头0磁道，然后读取1磁头0磁道，接着读取0磁头1磁道，最后读取1磁头1磁道。</p><figure><img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/kernel/Linux-0.11/Linux-0.11-boot/bootsect/boot_ok_read.png" alt="rp_read" tabindex="0" loading="lazy"><figcaption>rp_read</figcaption></figure><p><code>rp_read</code>首先判断是否已经读入了所有的数据(system模块)。比较<code>ax</code>和<code>ENDSEG</code>的值，如果不相等，则需要继续读取，于是跳转到<code>ok1_read</code>中执行。</p><p><code>ok1_read</code>位于161-172行：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>ok1_read:
	seg cs
	mov ax,sectors
	sub ax,sread
	mov cx,ax
	shl cx,#9
	add cx,bx
	jnc ok2_read
	je ok2_read
	xor ax,ax
	sub ax,bx
	shr ax,#9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ok1_read</code>主要计算了当前磁道上还有多少扇区没有读取完，并将当期磁道上还剩下的扇区数存在了<code>ax</code>中， 将下一次读磁盘读到的字节数存到了<code>cx</code>中。</p><p>下面这几句便是计算的过程：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov ax,sectors
	sub ax,sread          ！当前磁道还有多少扇区没有读，下面调用read_track的时候会使用到该参数
	mov cx,ax
	shl cx,#9             ！计算这一次读会读多少字节
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来进行判断，读到的数据是否超过了64KB。如果没有超过，则会跳转到<code>ok2_read</code>执行。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	add cx,bx             ！计算是否会超过64KB，64KB = 65536 = 1_00000000_00000000
	jnc ok2_read
	je ok2_read
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ok2_read/ok3_read/ok4_read位于173-196行。</p><p>ok2_read实际的作用就是将<strong>当前磁道上的所有扇区全部读完</strong>。更具体的，就是读取开始扇区<code>cl</code>和需读扇区数<code>al</code>的数据到<code>es:bx</code>开始处。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>ok2_read:
                          ! ax 先前已经设置
	call read_track
	mov cx,ax             ！cx = ax，本次读取的扇区数
	add ax,sread          ！当前磁道上已经读取的扇区数
	seg cs
	cmp ax,sectors        ！如果当前磁道上还有扇区未读，则跳转到ok3_read。
	jne ok3_read
	mov ax,#1             ！
	sub ax,head           ！判断当前磁头号
	jne ok4_read          ！如果是0磁头，则再去读1磁头上的扇区数据。如果是1磁头
	inc track             ！否则读取下一个磁道
ok4_read:
	mov	%ax, head         !保存当前的磁头号
	xor	%ax, %ax          !清除已读扇区数
ok3_read:
	mov	%ax, sread        !保存当前扇区已读扇区数
	shl	$9, %cx
	add	%cx, %bx
	jnc	rp_read           ！已经读取了64KB数据，调整当前段，为读取下一段数据做准备。
	mov	%es, %ax
	add	$0x1000, %ax      !刚开始是0x1000，读完64Kb之后，调整为0x2000，0x3000，最终到0x4000结束。
	mov	%ax, %es
	xor	%bx, %bx
	jmp	rp_read
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ok2_read</code>的第一句话是调用了<code>read_track</code>方法：</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>call read_track
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>read_track</code>的作用是读取当前磁道上的扇面到<code>es:bx</code>处。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>read_track:
	push ax            !保存ax,bx,cx,dx寄存器
	push bx            
	push cx            
	push dx
	mov dx,track       !获取当前的磁道号
	mov cx,sread       !获取当前磁道上的已读扇区数
	inc cx             !cl = 开始读的扇区号
	mov ch,dl          !ch = 当前磁道号
	mov dx,head        !dx = 当前磁头号， 目前磁头号还在dl中，后面会挪动到dh中。
	mov dh,dl          !将磁头号从dl挪动到dh中
	mov dl,#0          !dl = 驱动器号
	and dx,#0x0100     !将dx与0x0100进行按位与，实际就是使得磁头号小于等于1。
	mov ah,#2          !ah = 2，读磁盘扇区的功能号
	int 0x13           !0x13号中断， 读取磁盘数据。
	jc bad_rt          !如果出错，则跳转运行bad_rt
	pop dx             !恢复dx,cx,bx,ax寄存器
	pop cx
	pop bx
	pop ax
	ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>read_track</code>之后，会统计一些数据，看本磁道上的扇区是否全部读完，如果没有读完，则跳转到<code>ok3_read</code>进行再次读取。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov cx,ax             ！cx = ax，本次读取的扇区数
	add ax,sread          ！当前磁道上已经读取的扇区数
	seg cs
	cmp ax,sectors        ！如果当前磁道上还有扇区未读，则跳转到ok3_read。
	jne ok3_read
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果已经读完，则调整磁头和磁道，继续读取。这里指定了磁盘读取的顺序。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov ax,#1             ！
	sub ax,head           ！判断当前磁头号
	jne ok4_read          ！如果是0磁头，则再去读1磁头上的扇区数据。如果是1磁头
	inc track             ！否则读取下一个磁道
ok4_read:
	mov head,ax
	xor ax,ax
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要分情况进行讨论：</p><ul><li>如果当前是0磁头0磁道，即<code>head=0</code>， <code>track=0</code>则<code>ax = 1</code>，<code>sub ax, head</code>之后，<code>ax = 1</code>， 由于相减不等于0，因此<code>ZF = 0</code>，<code>jne</code>会进行跳转， 于是<code>head=1</code>。</li><li>如果当前是1磁头0磁道，即<code>head=1</code>， <code>track=0</code>则<code>ax = 0</code>，<code>sub ax, head</code>之后，<code>ax = 0</code>， 由于相减等于0，因此<code>ZF = 1</code>，<code>jne</code>不会进行跳转， 于是<code>head=0</code>，<code>track=1</code>。</li><li>如果当前是0磁头1磁道，即<code>head=0</code>， <code>track=1</code>则<code>ax = 1</code>，<code>sub ax, head</code>之后，<code>ax = 1</code>， 由于相减不等于0，因此<code>ZF = 0</code>，<code>jne</code>会进行跳转， 于是<code>head=1</code>。</li></ul><p>总结起来读取顺序是首先读取0磁头0磁道，然后读取1磁头0磁道，接着读取0磁头1磁道，最后读取1磁头1磁道。</p><p>读到这里应该对整个读取的过程有了一个概念，整个过程的流程如下所示：</p><figure><img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/kernel/Linux-0.11/Linux-0.11-boot/bootsect/read_disk.png" alt="read_disk" tabindex="0" loading="lazy"><figcaption>read_disk</figcaption></figure><p>看到这里，我们再回到调用<code>read_it</code>的地方, 我们看看当读取完system模块之后，还会做些什么操作。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	mov	ax,#SYSSEG
	mov	es,ax		! segment of 0x010000
	call	read_it
	call	kill_motor
! After that we check which root-device to use. If the device is
! defined (!= 0), nothing is done and the given device is used.
! Otherwise, either /dev/PS0 (2,28) or /dev/at0 (2,8), depending
! on the number of sectors that the BIOS reports currently.

	seg cs
	mov	ax,root_dev
	cmp	ax,#0
	jne	root_defined
	seg cs
	mov	bx,sectors
	mov	ax,#0x0208		! /dev/ps0 - 1.2Mb
	cmp	bx,#15
	je	root_defined
	mov	ax,#0x021c		! /dev/PS0 - 1.44Mb
	cmp	bx,#18
	je	root_defined
undef_root:
	jmp undef_root
root_defined:
	seg cs
	mov	root_dev,ax

! after that (everyting loaded), we jump to
! the setup-routine loaded directly after
! the bootblock:

	jmpi	0,SETUPSEG
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里首先判断了<code>root_dev</code>是否进行了定义。如果定义了，则跳转到<code>root_defined</code>执行。</p><p>0x0306</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	seg cs
	mov	ax,root_dev
	cmp	ax,#0
	jne	root_defined
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里需要补充一下Linux-0.11对于设备号的定义：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>设备号</mtext><mo>=</mo><mtext>主设备号</mtext><mo>∗</mo><mn>256</mn><mo>+</mo><mtext>次设备号</mtext></mrow><annotation encoding="application/x-tex"> 设备号 = 主设备号 * 256 + 次设备号 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">设备号</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">主设备号</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">次设备号</span></span></span></span></span></p><p>主设备号： 1-内存，2-磁盘，3-硬盘， 4-ttyx，5-tty，6-并行口，7非命名管道</p><table><thead><tr><th>主设备号</th><th>设备名</th><th>含义</th></tr></thead><tbody><tr><td>0x300</td><td>/dev/hd0</td><td>代表第1块硬盘</td></tr><tr><td>0x301</td><td>/dev/hd1</td><td>代表第1块硬盘的第1个分区</td></tr><tr><td>0x302</td><td>/dev/hd2</td><td>代表第1块硬盘的第2个分区</td></tr><tr><td>0x303</td><td>/dev/hd3</td><td>代表第1块硬盘的第3个分区</td></tr><tr><td>0x304</td><td>/dev/hd4</td><td>代表第1块硬盘的第4个分区</td></tr><tr><td>0x305</td><td>/dev/hd5</td><td>代表第2块硬盘</td></tr><tr><td>0x306</td><td>/dev/hd6</td><td>代表第2块硬盘的第1个分区</td></tr><tr><td>0x307</td><td>/dev/hd7</td><td>代表第2块硬盘的第2个分区</td></tr><tr><td>0x308</td><td>/dev/hd8</td><td>代表第2块硬盘的第3个分区</td></tr><tr><td>0x309</td><td>/dev/hd9</td><td>代表第2块硬盘的第4个分区</td></tr></tbody></table><p>在Linux-0.11中，这里的<code>ROOT_DEV</code>定义为<code>0x306</code>,因为当年linus是在第2块硬盘上的安装的文件系统。在编译内核时，可以根据自己的环境修改该参数。</p><p>假设没有定义<code>ROOT_DEV</code>，就需要根据BIOS的每磁道扇区数来决定是使用/dev/PS0(0x0208)还是/dev/at0(0x021c)。</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>	seg cs
	mov	bx,sectors
	mov	ax,#0x0208		! /dev/ps0 - 1.2Mb
	cmp	bx,#15
	je	root_defined
	mov	ax,#0x021c		! /dev/PS0 - 1.44Mb
	cmp	bx,#18
	je	root_defined
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>程序的最后，因为所有的需要加载的内容都加载完了，于是执行<code>jmpi 0,SETUPSEG</code>跳转到了setup.s中进行执行。</p><p>文章的最后，我们通过一张图回顾一下bootsect.s所做的一些事情：</p><figure><img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/kernel/Linux-0.11/Linux-0.11-boot/bootsect/bootsect-overview.png" alt="bootsect-overview" tabindex="0" loading="lazy"><figcaption>bootsect-overview</figcaption></figure><p>文中如有表达不正确之处，欢迎大家与我交流，微信号codebuilding。</p><figure><img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/personal/wechat.jpg" alt="wechat" tabindex="0" loading="lazy"><figcaption>wechat</figcaption></figure><hr><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2><p><a href="https://github.com/Wangzhike/HIT-Linux-0.11/blob/master/1-boot/OS-booting.md" target="_blank" rel="noopener noreferrer">https://github.com/Wangzhike/HIT-Linux-0.11/blob/master/1-boot/OS-booting.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-bootsect.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 119160524@qq.com">zgjsxx</span>,<!--]--><!--[--><span class="contributor" title="email: 119160625@qq.com">zgjsxx</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-assemble-language.html" class="nav-link prev" aria-label="Linux-0.11中的汇编"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->Linux-0.11中的汇编</div></a><a href="/posts/Linux/kernel/Linux-0.11/Linux-0.11-boot-setup.html" class="nav-link next" aria-label="Linux-0.11 boot目录setup.s详解"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Linux-0.11 boot目录setup.s详解<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Code Building</div><div class="copyright">Copyright © 2024 程序员小x</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-c197ebf9.js" defer></script>
  </body>
</html>

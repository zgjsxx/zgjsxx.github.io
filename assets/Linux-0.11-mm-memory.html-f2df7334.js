import{_ as a,V as e,W as n,a0 as s}from"./framework-c954d91f.js";const o={},p=s(`<h1 id="linux-0-11-memory-c详解" tabindex="-1"><a class="header-anchor" href="#linux-0-11-memory-c详解" aria-hidden="true">#</a> Linux-0.11 memory.c详解</h1><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><p>内存区域划分 <img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/Linux-0.11-memory/mem-area.png" alt="memory-area" loading="lazy"></p><p>在Linux-0.11内核中，所有进程都使用一个页目录表，而每个进程都有自己的页表。</p><p>页目录表和页表的格式 <img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/Linux-0.11-memory/page_frame.png" alt="memory-area" loading="lazy"></p><p>图中页表项的第0位P代表<strong>存在位</strong>，该位表示这个页表项是否可以用于地址转换，P=1代表该项可用， 当目录表项或者第二级表项的P=0时，代表该项是无效的，不能用于地址转换。</p><p>当P=0时， 处理器会发出缺页异常的信号， 缺页中断的异常处理程序就可以将所请求的页面加入到物理内存中。</p><h2 id="函数分析" tabindex="-1"><a class="header-anchor" href="#函数分析" aria-hidden="true">#</a> 函数分析</h2><h3 id="get-free-page" tabindex="-1"><a class="header-anchor" href="#get-free-page" aria-hidden="true">#</a> get_free_page</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token function">get_free_page</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>作用</strong>: 获取一个空闲页面， 从内存的高地址向低地址开始搜索</p><p>%1: ax = 0 %2 LOW_MEM %3: cx = PAGING_PAGES %4 edi = mem_map+PAGING_PAGES-1</p><p>将edi的值指向了mem_map数组的尾,如下图所示：</p><figure><img src="https://github.com/zgjsxx/static-img-repo/raw/main/blog/Linux/Linux-0.11-memory/get_free_page.png" alt="get_free_page" tabindex="0" loading="lazy"><figcaption>get_free_page</figcaption></figure><p>然后从mem_map的尾部向前搜寻为0的项目，这样就可以找到空闲的物理内存。</p><h3 id="free-page" tabindex="-1"><a class="header-anchor" href="#free-page" aria-hidden="true">#</a> free_page</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">free_page</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>该函数的作用就是释放某个地址所在的内存页。</p><h3 id="do-wp-page" tabindex="-1"><a class="header-anchor" href="#do-wp-page" aria-hidden="true">#</a> do_wp_page</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">do_wp_page</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> error_code<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> address<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="un-wp-page" tabindex="-1"><a class="header-anchor" href="#un-wp-page" aria-hidden="true">#</a> un_wp_page</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">un_wp_page</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token operator">*</span> table_entry<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>作用</strong>: 取消写保护异常，用于页异常中断过程中写保护异常的处理(写时复制)</p><h3 id="do-no-page" tabindex="-1"><a class="header-anchor" href="#do-no-page" aria-hidden="true">#</a> do_no_page</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">do_no_page</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> error_code<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> address<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>作用</strong>: 执行缺页处理</p>`,26),i=[p];function r(d,t){return e(),n("div",null,i)}const l=a(o,[["render",r],["__file","Linux-0.11-mm-memory.html.vue"]]);export{l as default};

import{_ as e,V as t,W as p,X as n,Y as s,$ as l,a0 as i,F as o}from"./framework-9a29aaa0.js";const c={},r=n("h1",{id:"mysql-8-0-33源码编译",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mysql-8-0-33源码编译","aria-hidden":"true"},"#"),s(" mysql 8.0.33源码编译")],-1),u=n("p",null,"由于想对mysql的行锁的实现进行一些研究，于是希望自己编译mysql的debug版本进行调试，本文用于记录编译的过程。",-1),d=n("h2",{id:"编译步骤",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#编译步骤","aria-hidden":"true"},"#"),s(" 编译步骤")],-1),m=n("p",null,"首先需要下载源码，mysql的源码在github上可以找到，这里选择8.0.33版本进行下载，下载地址为：",-1),k={href:"https://github.com/mysql/mysql-server/archive/refs/tags/mysql-8.0.33.tar.gz",target:"_blank",rel:"noopener noreferrer"},v=i(`<p>我这里使用的操作系统是rocky linux9，因为其工具链都相对较新。</p><p>接下来将使用cmake进行编译，编译之前需要安装一些依赖。</p><p>这里列举出了一些可能要安装的包，可能不全，可以根据报错提示去安装。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> gcc-toolset-12-gcc gcc-toolset-12-gcc-c++ gcc-toolset-12-binutils gcc-toolset-12-annobin-annocheck gcc-toolset-12-annobin-plugin-gcc <span class="token parameter variable">-y</span>

yum <span class="token function">install</span> openssl-devel <span class="token parameter variable">-y</span>

yum <span class="token function">install</span> ncurses-devel <span class="token parameter variable">-y</span>

dnf <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span>devel <span class="token function">install</span> libtirpc-devel <span class="token parameter variable">-y</span> 

yum <span class="token function">install</span> rpcgen <span class="token parameter variable">-y</span>

yum <span class="token function">install</span> libudev-devel <span class="token parameter variable">-y</span>

yum <span class="token function">install</span> bison <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意<strong>bison</strong>依赖如果没有，只会有一个warning提示，这里是需要安装的，否则会出现下面的错误：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>CMake Error at sql/CMakeLists.txt:1294 <span class="token punctuation">(</span>MESSAGE<span class="token punctuation">)</span>:
  Cannot <span class="token function">find</span> /home/work/cpp_proj/mysql-server-mysql-8.0.33/sql/sql_yacc.h
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完依赖项目之后，可以尝试使用cmake进行构建。执行make之后就等待就可以了，在我的虚拟机中，make步骤大约需要30min。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DWITH_DEBUG</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-DDOWNLOAD_BOOST</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-DWITH_BOOST</span><span class="token operator">=</span>/home/work/cpp_proj/mysql-server-mysql-8.0.33/build/boost <span class="token punctuation">\\</span>
<span class="token parameter variable">-DCMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/home/work/cpp_proj/mysql-server-mysql-8.0.33/build/install <span class="token punctuation">\\</span>
<span class="token parameter variable">-DMYSQL_DATADIR</span><span class="token operator">=</span>/home/work/cpp_proj/mysql-server-mysql-8.0.33/build/install/data

<span class="token function">make</span> <span class="token parameter variable">-j8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直到输出了下面的语句后，代表编译成功完成了。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_http_server
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_logging_eventlog
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_rest_mock_server
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_master_key_reader_writer
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_pidfile
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_rest_api_enable
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_sd_notify
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_rest_metadata_cache
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_component_rest_routing
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target rest_signal
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_integration_routing_direct
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_integration_routing_reuse
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_integration_routing_sharing
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_integration_routing_sharing_constrained_pools
<span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span> Built target routertest_integration_routing_sharing_restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="运行mysql" tabindex="-1"><a class="header-anchor" href="#运行mysql" aria-hidden="true">#</a> 运行mysql</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ./mysqld</span>
<span class="token number">2023</span>-07-10T07:20:18.057441Z <span class="token number">0</span> <span class="token punctuation">[</span>System<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010116<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> /home/work/cpp_proj/mysql-server-mysql-8.0.33/build/runtime_output_directory/mysqld <span class="token punctuation">(</span>mysqld <span class="token number">8.0</span>.33-debug<span class="token punctuation">)</span> starting as process <span class="token number">82471</span>
<span class="token number">2023</span>-07-10T07:20:18.066237Z <span class="token number">0</span> <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010091<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> Can&#39;t create <span class="token builtin class-name">test</span> <span class="token function">file</span> /home/work/cpp_proj/mysql-server-mysql-8.0.33/build/data/mysqld_tmp_file_case_insensitive_test.lower-test
<span class="token number">2023</span>-07-10T07:20:18.066251Z <span class="token number">0</span> <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010159<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> Setting <span class="token assign-left variable">lower_case_table_names</span><span class="token operator">=</span><span class="token number">2</span> because <span class="token function">file</span> system <span class="token keyword">for</span> /home/work/cpp_proj/mysql-server-mysql-8.0.33/build/data/ is <span class="token keyword">case</span> insensitive
<span class="token number">2023</span>-07-10T07:20:18.067139Z <span class="token number">0</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010123<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> Fatal error: Please <span class="token builtin class-name">read</span> <span class="token string">&quot;Security&quot;</span> section of the manual to <span class="token function">find</span> out how to run mysqld as root<span class="token operator">!</span>
<span class="token number">2023</span>-07-10T07:20:18.067249Z <span class="token number">0</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010119<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> Aborting
<span class="token number">2023</span>-07-10T07:20:18.071351Z <span class="token number">0</span> <span class="token punctuation">[</span>System<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010910<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> /home/work/cpp_proj/mysql-server-mysql-8.0.33/build/runtime_output_directory/mysqld: Shutdown complete <span class="token punctuation">(</span>mysqld <span class="token number">8.0</span>.33-debug<span class="token punctuation">)</span>  Source distribution.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./mysqld --initialize --console
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2023-07-10T10:17:45.487502Z 0 [System] [MY-013169] [Server] /home/work/cpp_proj/mysql-server-mysql-8.0.33/build/runtime_output_directory/mysqld (mysqld 8.0.33-debug) initializing of server in progress as process 144794
2023-07-10T10:17:45.502792Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2023-07-10T10:17:46.365687Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
2023-07-10T10:17:54.519035Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: Ywcl7uFuSy/f
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14);function b(_,g){const a=o("ExternalLinkIcon");return t(),p("div",null,[r,u,d,m,n("p",null,[n("a",k,[s("https://github.com/mysql/mysql-server/archive/refs/tags/mysql-8.0.33.tar.gz"),l(a)])]),v])}const y=e(c,[["render",b],["__file","mysql_source_code_build.html.vue"]]);export{y as default};
